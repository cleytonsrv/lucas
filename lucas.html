<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flow Easy</title>
  <!-- Bibliotecas para exporta√ß√£o PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* RESET */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    /* Vari√°veis para Temas (Claro e Escuro) */
    :root {
      --background-color: #f5f5f5;
      --card-bg: #ffffff;
      --primary-color: #0c3c82;
      --primary-light: #1976d2;
      --primary-gradient: linear-gradient(135deg, #1976d2, #64b5f6);
      --secondary-color: #333333;
      --text-color: #333333;
      --text-secondary: #666666;
      --border-color: #e0e0e0;
      --menu-bg: #ffffff;
      --menu-item-bg: #f0f4ff;
      --menu-item-hover: #e6f0ff;
      --modal-bg: rgba(0, 0, 0, 0.5);
      --input-bg: #f5f5f5;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --success-color: #4caf50;
      --error-color: #f44336;
      --login-gradient: linear-gradient(to bottom, #1a237e 0%, #1e3fc7 30%, #0d47a1 50%, #1e88e5 80%, #29b6f6 100%);
    }

    /* Vari√°veis para o Tema Escuro */
    [data-theme="dark"] {
      --background-color: #1e1e2e;
      --card-bg: #2a2a3a;
      --primary-color: #64b5f6;
      --primary-light: #90caf9;
      --primary-gradient: linear-gradient(135deg, #0d47a1, #2196f3);
      --secondary-color: #bcbcbc;
      --text-color: #eceff1;
      --text-secondary: #b0bec5;
      --border-color: #404040;
      --menu-bg: #2a2a3a;
      --menu-item-bg: #3a3a4a;
      --menu-item-hover: #4a4a5a;
      --modal-bg: rgba(0, 0, 0, 0.7);
      --input-bg: #3a3a4a;
      --shadow-color: rgba(0, 0, 0, 0.25);
      --success-color: #81c784;
      --error-color: #e57373;
      --login-gradient: linear-gradient(to bottom, #1a237e 0%, #1e3fc7 30%, #0d47a1 50%, #1e88e5 80%, #29b6f6 100%);
    }

    /* BODY: Classes para tela de login ou menu */
    body.login-bg {
      background: var(--login-gradient);
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100vh; 
      overflow: hidden;
    }
    body.menu-bg {
      background-color: var(--background-color);
      min-height: 100vh;
      overflow: auto;
      color: var(--text-color);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Classe para ocultar elementos */
    .hidden {
      display: none !important;
    }

    /* TELA DE LOGIN */
    .login-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      max-width: 90%;
      background-color: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 10px 25px var(--shadow-color);
      text-align: center;
      padding: 40px;
    }

    @media (max-width: 576px) {
      .login-container {
        padding: 30px 20px;
        width: 320px;
    }

    .login-container h1 {
        font-size: 24px;
        margin-bottom: 20px;
      }
      
      .input-group input {
        padding: 12px;
        font-size: 14px;
      }
    }

    .login-container h1 {
      color: var(--primary-color);
      margin-bottom: 30px;
    }

    .input-group {
      margin-bottom: 20px;
      position: relative;
    }
    .input-group input {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 5px;
      background-color: var(--input-bg);
      font-size: 16px;
      transition: all 0.3s;
      border-left: 4px solid transparent;
      color: var(--text-color);
    }
    .input-group input:focus {
      outline: none;
      background-color: var(--card-bg);
      box-shadow: 0 0 0 2px var(--primary-light);
      border-left: 4px solid var(--primary-light);
    }
    .input-group label {
      position: absolute;
      left: 15px;
      top: 15px;
      color: var(--text-secondary);
      transition: all 0.3s;
      pointer-events: none;
    }
    .input-group input:focus + label,
    .input-group input:not(:placeholder-shown) + label {
      transform: translateY(-25px);
      font-size: 12px;
      color: var(--primary-light);
      background-color: var(--card-bg);
      padding: 0 5px;
    }
    .input-group input::placeholder {
      color: transparent;
    }

    .login-btn {
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 15px;
      width: 100%;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }
    .login-btn:hover {
      background: linear-gradient(135deg, #0d47a1, #1976d2);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .message {
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: none;
    }
    .error-message {
      color: var(--error-color);
      background-color: rgba(244, 67, 54, 0.1);
    }
    .success-message {
      color: var(--success-color);
      background-color: rgba(76, 175, 80, 0.1);
    }

    /* MENU CONTAINER */
    .menu-container {
      display: none;
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: row;
    }

    /* Bot√£o para mobile */
    #mobileMenuToggle {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      background-color: #0c3c82;
      color: white;
      border: none;
      border-radius: 5px;
      width: 40px;
      height: 40px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* SIDEBAR */
    .sidebar {
      width: 260px;
      background-color: var(--menu-bg);
      box-shadow: 2px 0 5px var(--shadow-color);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 24px 16px;
      position: sticky;
      top: 0;
      height: 100vh;
      transition: all 0.3s ease;
      z-index: 100;
    }
    
    /* Responsividade */
    @media (max-width: 992px) {
      .menu-container {
        flex-direction: column;
      }
      
      #mobileMenuToggle {
        display: block;
      }
      
      .sidebar {
        position: fixed;
        left: -260px; /* Escondido por padr√£o */
        height: 100%;
        width: 260px;
      }
      
      .sidebar.active {
        left: 0; /* Vis√≠vel quando ativo */
      }
      
      .main-content {
        margin-left: 0 !important;
        padding: 20px !important;
      }
      
      /* Fundo escuro quando menu est√° aberto */
      .menu-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0,0,0,0.5);
        z-index: 99;
      }
      
      .menu-overlay.active {
        display: block;
      }
    }
    
    /* Dispositivos ainda menores */
    @media (max-width: 576px) {
      .stats-cards {
        grid-template-columns: 1fr !important;
      }
      
      .chart-container {
        grid-template-columns: 1fr !important;
      }
      
      .route-btn {
        flex: 1 1 calc(50% - 15px) !important;
      }
    }

    /* Ajustes para tablets */
    @media (min-width: 577px) and (max-width: 991px) {
      .stats-cards {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      
      .route-btn {
        flex: 1 1 calc(33.33% - 15px) !important;
      }
    }

    /* Adicionando estilos para as imagens de logo */
    .logo {
      font-weight: bold;
      font-size: 24px;
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 40px;
      padding: 15px 0;
      border-bottom: 2px solid var(--border-color);
    }
    
    /* Estilo para a imagem da logo */
    .logo-img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    
    /* Estilo para a logo na tela de login */
    .login-logo {
      max-width: 200px;
      margin: 0 auto 30px;
    }
    
    /* Estilo para a logo na sidebar */
    .sidebar .logo-img {
      max-width: 170px;
      padding: 5px 0;
    }
    
    .menu a {
      display: flex;
      align-items: center;
      padding: 14px 20px;
      margin-bottom: 12px;
      background-color: var(--menu-item-bg);
      color: var(--primary-color);
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .menu a:before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--primary-light);
      transform: scaleY(0);
      transition: transform 0.3s ease;
      border-radius: 10px 0 0 10px;
    }
    .menu a.active {
      background-color: var(--menu-item-hover);
      box-shadow: 0 4px 8px var(--shadow-color);
    }
    .menu a.active:before {
      transform: scaleY(1);
    }
    .menu a:hover {
      background-color: var(--menu-item-hover);
      transform: translateX(5px);
    }
    .menu a i {
      margin-right: 12px;
      font-size: 18px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      padding: 16px;
      margin: 20px 0;
      background-color: var(--menu-item-bg);
      border-radius: 10px;
      box-shadow: 0 2px 5px var(--shadow-color);
    }
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary-light);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 12px;
    }
    .user-details {
      flex: 1;
    }
    .user-name {
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 4px;
      font-size: 16px;
    }
    .user-role {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .logout-btn {
      background: linear-gradient(to right, #ef4444, #dc2626);
      color: #fff;
      border: none;
      padding: 14px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logout-btn i {
      margin-right: 8px;
    }
    .logout-btn:hover {
      background: linear-gradient(to right, #dc2626, #b91c1c);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(239, 68, 68, 0.2);
    }

    /* CONTE√öDO PRINCIPAL */
    .main-content {
      flex: 1;
      padding: 40px;
      transition: all 0.3s ease;
      color: var(--text-color);
    }
    
    @media (max-width: 768px) {
    .main-content h1 {
        font-size: 22px;
      }
      
      .bar-chart {
        height: 180px;
        padding-left: 20px;
      }
      
      .bar:before, .bar:after {
        font-size: 10px;
      }
      
      .popup-content {
        padding: 20px;
        max-width: 90%;
      }
    }

    .main-content h1 {
      color: var(--primary-color);
      font-size: 24px;
      margin-bottom: 10px;
    }
    .main-content p {
      font-size: 16px;
      color: var(--text-color);
    }

    /* ESTILOS PARA "GERAR DOCUMENTOS" */
    .gerar-doc-container {
      /* Removendo borda e cor de fundo */
      margin: 20px 0;
      padding: 0;
      border: none;
      background-color: transparent;
    }
    .gerar-doc-container label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary-color);
    }
    .gerar-doc-container input {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 10px;
      background-color: var(--card-bg);
      font-size: 15px;
      box-shadow: inset 2px 2px 5px var(--shadow-color),
                 inset -2px -2px 5px rgba(255,255,255,0.5);
      transition: all 0.3s ease;
    }
    .gerar-doc-container input:focus {
      outline: none;
      box-shadow: inset 3px 3px 7px var(--shadow-color),
                 inset -3px -3px 7px rgba(255,255,255,0.5);
    }
    .button-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
    }
    .route-btn {
      flex: 1 1 calc(25% - 15px);
      min-width: 100px;
      padding: 14px 10px;
      background: var(--card-bg);
      border: 2px solid var(--primary-color);
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      font-weight: 600;
      color: var(--primary-color);
      transition: all 0.3s ease;
      box-shadow: 3px 3px 8px var(--shadow-color);
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
    }
    .route-btn:hover, .route-btn.active {
      background: var(--primary-gradient);
      color: white;
      border-color: transparent;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(25, 118, 210, 0.3);
    }
    .route-btn:active {
      transform: translateY(1px);
      box-shadow: 3px 3px 6px var(--shadow-color);
    }
    /* Adicionando efeito de sele√ß√£o para bot√µes ativos */
    .route-btn.active {
      background: var(--primary-gradient);
      color: white;
      border-color: transparent;
      box-shadow: inset 3px 3px 6px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(25, 118, 210, 0.5);
      transform: translateY(0);
    }
    .route-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: white;
      box-shadow: 0 -1px 5px rgba(255, 255, 255, 0.7);
    }
    #routeInputContainer {
      display: none;
    }
    #sendRouteBtn {
      width: 150px;
      padding: 14px;
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 5px 5px 10px var(--shadow-color);
      align-self: flex-start;
    }
    #sendRouteBtn:hover {
      background: linear-gradient(135deg, #0d47a1, #1976d2);
      transform: translateY(-3px);
    }
    #sendRouteBtn:active {
      transform: translateY(1px);
      box-shadow: 3px 3px 6px var(--shadow-color);
    }
    /* Estilos para os popups */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--modal-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }
    .popup-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .popup-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 25px var(--shadow-color);
      text-align: center;
      transform: translateY(-20px);
      transition: transform 0.3s;
    }
    .popup-overlay.active .popup-content {
      transform: translateY(0);
    }
    .popup-title {
      color: var(--primary-color);
      font-size: 20px;
      margin-bottom: 20px;
    }
    .popup-input {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 10px;
      background-color: var(--input-bg);
      font-size: 16px;
      margin-bottom: 20px;
      box-shadow: inset 2px 2px 5px var(--shadow-color);
      color: var(--text-color);
    }
    .popup-input:focus {
      outline: none;
      box-shadow: inset 3px 3px 7px var(--shadow-color);
    }
    .popup-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .popup-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .popup-btn-primary {
      background: var(--primary-gradient);
      color: white;
      box-shadow: 5px 5px 10px var(--shadow-color);
    }
    .popup-btn-primary:hover {
      background: linear-gradient(135deg, #0d47a1, #1976d2);
      transform: translateY(-3px);
    }
    .popup-btn-secondary {
      background: var(--menu-item-bg);
      color: var(--primary-color);
      box-shadow: 5px 5px 10px var(--shadow-color);
    }
    .popup-btn-secondary:hover {
      background: var(--menu-item-hover);
      transform: translateY(-3px);
    }

    /* Bot√£o de alternar tema */
    .theme-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--primary-gradient);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      font-size: 20px;
      box-shadow: 0 2px 5px var(--shadow-color);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 10;
    }
    
    .theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow-color);
    }

    /* Elementos do Dashboard */
    .stat-card {
      background: var(--card-bg);
      box-shadow: 0 4px 12px var(--shadow-color);
    }
    
    .stat-value {
      color: var(--primary-color);
    }
    
    .stat-label {
      color: var(--text-secondary);
    }
    
    .chart-box {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 12px var(--shadow-color);
      margin-bottom: 30px;
      overflow: hidden;
    }
    
    .chart-title {
      color: var(--primary-color);
    }
    
    .data-table th {
      color: var(--primary-color);
    }
    
    .data-table td {
      color: var(--text-color);
    }
    
    .data-table tr:hover {
      background-color: var(--menu-item-bg);
    }
    
    .recent-activity {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 12px var(--shadow-color);
      margin-top: 20px;
      margin-bottom: 30px;
      overflow: hidden;
    }
    
    .data-table-container {
      overflow-x: auto;
      margin-top: 15px;
      margin-bottom: 5px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 300px;
    }
    
    .data-table th, .data-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    .data-table th {
      position: sticky;
      top: 0;
      font-weight: 600;
      color: var(--primary-color);
      background-color: var(--card-bg);
      z-index: 1;
    }
    
    .data-table td {
      color: var(--text-color);
    }
    
    .data-table tr:hover {
      background-color: var(--menu-item-bg);
    }
    
    .activity-item {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
    }
    
    .activity-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 10px;
    }
    
    .status-gerado { background-color: #4caf50; }
    .status-pendente { background-color: #ff9800; }
    .status-enviado { background-color: #2196f3; }
    .status-cancelado { background-color: #f44336; }
    
    .activity-info {
      flex: 1;
    }
    
    .activity-time {
      color: #999;
      font-size: 12px;
    }
    
    .refresh-btn {
      background: linear-gradient(145deg, #1976d2, #64b5f6);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }
    
    .refresh-btn:hover {
      background: linear-gradient(145deg, #0d47a1, #1976d2);
      transform: translateY(-2px);
    }

    /* Estilos para os gr√°ficos */
    .bar-chart {
      position: relative;
      height: 250px; /* Aumentando a altura */
      margin-top: 50px;
      margin-bottom: 50px;
      padding-left: 5px;
      padding-right: 5px;
      border-bottom: 1px solid var(--border-color);
      overflow-x: auto;
      overflow-y: hidden; /* Impedir rolagem vertical */
      min-height: 300px;
    }
    
    .bar-chart-container {
      display: flex;
      height: 200px;
      min-width: 100%;
      align-items: flex-end;
      padding-bottom: 30px; /* Espa√ßo para valores */
      width: max-content; /* Importante para permitir que o conte√∫do determine a largura */
    }
    
    .bar {
      flex: 0 0 20px; /* Reduzindo de 30px para 20px */
      margin: 0 10px; /* Reduzindo o espa√ßo entre as barras de 20px para 10px */
      background: linear-gradient(to top, var(--primary-light), #64b5f6);
      min-width: 15px; /* Reduzindo de 20px para 15px */
      max-width: 20px; /* Reduzindo de 30px para 20px */
      border-radius: 5px 5px 0 0;
      position: relative;
    }
    
    .bar:after {
      content: attr(data-value);
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      white-space: nowrap;
      color: var(--text-color);
      text-align: center;
    }
    
    .bar:before {
      content: attr(data-label);
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%) rotate(-15deg);
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 80px; /* Largura m√°xima do r√≥tulo */
      color: var(--text-color);
      text-align: center;
    }
    
    /* Indicador de rolagem */
    .scroll-indicator {
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: var(--text-secondary);
      background-color: rgba(255, 255, 255, 0.8);
      padding: 3px 8px;
      border-radius: 10px;
      box-shadow: 0 2px 4px var(--shadow-color);
      z-index: 5;
      white-space: nowrap;
    }
    
    /* Ajustes para mobile */
    @media (max-width: 768px) {
      .bar-chart {
        padding-left: 0;
        margin-bottom: 60px;
        height: 220px;
      }
      
      .bar-chart-container {
        height: 180px;
      }
      
      .chart-box {
        padding: 15px 10px;
        margin-bottom: 25px;
      }
      
      .chart-title {
        font-size: 16px !important;
        text-align: center;
      }
      
      .bar {
        flex: 0 0 15px; /* Reduzindo de 25px para 15px */
        margin: 0 8px; /* Reduzindo de 12px para 8px */
        min-width: 10px; /* Reduzindo de 15px para 10px */
        max-width: 15px; /* Reduzindo de 25px para 15px */
      }
      
      .recent-activity {
        padding: 15px 10px;
        margin-bottom: 25px;
      }
      
      .data-table th, .data-table td {
        padding: 10px;
      }
      
      .data-table th {
        font-size: 14px;
      }
      
      .scroll-indicator {
        font-size: 10px;
        bottom: -20px;
      }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .dashboard-container {
      display: none;
    }
    
    .dashboard-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 15px;
    }

    .filter-container {
      display: none; /* Ocultar completamente em vez de remover, para evitar problemas com refer√™ncias */
    }

    .filter-container label {
      display: none;
    }

    .periodo-select, .data-input {
      display: none;
    }

    .datas-personalizado {
      display: none !important;
    }

    .apply-btn {
      display: none;
    }

    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    /* Estilos para tooltips nos gr√°ficos */
    .tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s, transform 0.2s;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      max-width: 200px;
      text-align: center;
      transform: translateY(10px);
      will-change: transform;
    }
    
    .tooltip.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .tooltip:after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: rgba(0, 0, 0, 0.8);
      transform: rotate(45deg);
      left: -4px; /* Padr√£o para tooltip √† direita do cursor */
      top: calc(50% - 4px);
    }
    
    .tooltip.left-position:after {
      left: auto;
      right: -4px; /* Para tooltip √† esquerda do cursor */
    }
    
    .bar {
      flex: 0 0 20px; /* Reduzindo de 30px para 20px */
      margin: 0 10px; /* Reduzindo o espa√ßo entre as barras de 20px para 10px */
      background: linear-gradient(to top, var(--primary-light), #64b5f6);
      min-width: 15px; /* Reduzindo de 20px para 15px */
      max-width: 20px; /* Reduzindo de 30px para 20px */
      border-radius: 5px 5px 0 0;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .bar:hover {
      transform: translateY(-5px);
    }

    .dashboard-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 15px;
    }
    
    .control-group {
      display: flex;
      gap: 10px;
    }

    .filter-container {
      display: none; /* Ocultar completamente em vez de remover, para evitar problemas com refer√™ncias */
    }
    
    .export-btn {
      background: linear-gradient(145deg, #2e7d32, #4caf50);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    
    .export-btn:hover {
      background: linear-gradient(145deg, #1b5e20, #388e3c);
      transform: translateY(-2px);
    }
    
    .export-btn:before {
      content: "üìÑ";
      margin-right: 8px;
    }
    
    .refresh-btn {
      background: linear-gradient(145deg, #1976d2, #64b5f6);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 0;
      display: flex;
      align-items: center;
    }
    
    .refresh-btn:before {
      content: "üîÑ";
      margin-right: 8px;
    }

    /* Estilos para indicadores de carregamento */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid white;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .models-empty, .models-error {
      text-align: center;
      padding: 30px;
      color: var(--text-muted);
      background-color: var(--card-bg);
      border-radius: 8px;
      border: 1px dashed var(--border-color);
    }
    
    .models-error {
      color: #e74c3c;
      border-color: #e74c3c;
    }

    /* Estilos para notifica√ß√µes e alertas */
    .notification {
      position: fixed;
      top: -100px;
      right: 30px;
      min-width: 300px;
      max-width: 500px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 9999;
      transform: translateY(-20px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      border-left: 5px solid var(--primary-color);
    }
    
    .notification.success {
      border-left-color: #2ecc71;
    }
    
    .notification.error {
      border-left-color: #e74c3c;
    }
    
    .notification.warning {
      border-left-color: #f39c12;
    }
    
    .notification.info {
      border-left-color: var(--primary-color);
    }
    
    .notification.show {
      opacity: 1;
      top: 30px;
      transform: translateY(0);
    }
    
    .notification-icon {
      font-size: 24px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .notification.success .notification-icon {
      background-color: rgba(46, 204, 113, 0.2);
      color: #2ecc71;
    }
    
    .notification.error .notification-icon {
      background-color: rgba(231, 76, 60, 0.2);
      color: #e74c3c;
    }
    
    .notification.warning .notification-icon {
      background-color: rgba(243, 156, 18, 0.2);
      color: #f39c12;
    }
    
    .notification.info .notification-icon {
      background-color: rgba(52, 152, 219, 0.2);
      color: var(--primary-color);
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--text-color);
    }
    
    .notification-message {
      color: var(--text-muted);
      font-size: 14px;
    }
    
    .notification-close {
      color: var(--text-muted);
      cursor: pointer;
      padding: 5px;
      transition: all 0.2s;
    }
    
    .notification-close:hover {
      color: var(--text-color);
    }
    
    .notification-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.1);
    }
    
    .notification-progress-bar {
      height: 100%;
      width: 100%;
      background-color: var(--primary-light);
      transform-origin: left;
      animation: progress 5s linear forwards;
    }
    
    .notification.success .notification-progress-bar {
      background-color: #2ecc71;
    }
    
    .notification.error .notification-progress-bar {
      background-color: #e74c3c;
    }
    
    .notification.warning .notification-progress-bar {
      background-color: #f39c12;
    }
    
    @keyframes progress {
      0% { transform: scaleX(1); }
      100% { transform: scaleX(0); }
    }
    
    /* Estilo para a mensagem de erro nos modelos */
    .models-error {
      text-align: center;
      padding: 30px;
      border-radius: 8px;
      background-color: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      color: #e74c3c;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    
    .models-error i {
      font-size: 40px;
      color: #e74c3c;
    }
    
    .models-error p {
      margin: 0;
      font-size: 15px;
    }
    
    .models-error .retry-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      margin-top: 10px;
    }
    
    .models-error .retry-btn:hover {
      background-color: #c0392b;
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    }
    
    .models-empty {
      text-align: center;
      padding: 40px 30px;
      border-radius: 8px;
      background-color: rgba(52, 152, 219, 0.05);
      border: 1px dashed var(--border-color);
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    
    .models-empty i {
      font-size: 40px;
      color: var(--text-muted);
    }
    
    .models-empty p {
      margin: 0;
      font-size: 15px;
    }

    /* Estilos para modal de confirma√ß√£o personalizado */
    .custom-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .custom-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .custom-modal-content {
      width: 90%;
      max-width: 450px;
      background-color: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      transform: translateY(-30px);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .custom-modal.active .custom-modal-content {
      transform: translateY(0);
    }
    
    .custom-modal-header {
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }
    
    .custom-modal-header h3 {
      margin: 0;
      color: var(--text-color);
      font-size: 18px;
    }
    
    .custom-modal-close {
      cursor: pointer;
      font-size: 24px;
      color: var(--text-muted);
      line-height: 1;
      transition: all 0.2s;
    }
    
    .custom-modal-close:hover {
      color: var(--text-color);
    }
    
    .custom-modal-body {
      padding: 20px;
      color: var(--text-color);
    }
    
    .custom-modal-body p {
      margin: 0 0 10px;
    }
    
    .custom-modal-body .warning-text {
      color: #e74c3c;
      font-weight: 500;
    }
    
    .custom-modal-footer {
      padding: 15px 20px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      border-top: 1px solid var(--border-color);
    }
    
    .custom-modal-footer button {
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      border: none;
    }
    
    .custom-modal-footer .btn-cancel {
      background-color: var(--button-secondary-bg);
      color: var(--text-color);
    }
    
    .custom-modal-footer .btn-confirm {
      background-color: #e74c3c;
      color: white;
    }
    
    .custom-modal-footer .btn-cancel:hover {
      background-color: #dddfe2;
    }
    
    .custom-modal-footer .btn-confirm:hover {
      background-color: #c0392b;
    }

    /* Estilo para o bot√£o fixo de atualiza√ß√£o */
    .botao-fixo-atualizar {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #ff9800; 
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      border: none;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      z-index: 10000;
      cursor: pointer;
    }
    .botao-fixo-atualizar:hover {
      background-color: #f57c00;
    }

    /* Anima√ß√£o para o bot√£o de atualizar */
    @keyframes shine {
      0% { left: -100%; }
      50% { left: 100%; }
      100% { left: 100%; }
    }
    
    #btn-atualizar-documento:hover {
      background-color: #e08600 !important;
      transform: scale(1.03);
      transition: all 0.2s ease;
    }

    /* Estilos para as rotas e documentos */
    .button-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
    }
    .route-btn {
      flex: 1 1 calc(25% - 15px);
      min-width: 100px;
      padding: 14px 10px;
      background: var(--card-bg);
      border: 2px solid var(--primary-color);
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      font-weight: 600;
      color: var(--primary-color);
      transition: all 0.3s ease;
      box-shadow: 3px 3px 8px var(--shadow-color);
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
    }
    .route-btn:hover, .route-btn.active {
      background: var(--primary-gradient);
      color: white;
      border-color: transparent;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(25, 118, 210, 0.3);
    }
    .route-btn:active {
      transform: translateY(1px);
      box-shadow: 3px 3px 6px var(--shadow-color);
    }
    /* Adicionando efeito de sele√ß√£o para bot√µes ativos */
    .route-btn.active {
      background: var(--primary-gradient);
      color: white;
      border-color: transparent;
      box-shadow: inset 3px 3px 6px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(25, 118, 210, 0.5);
      transform: translateY(0);
    }
    .route-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: white;
      box-shadow: 0 -1px 5px rgba(255, 255, 255, 0.7);
    }
    
    /* Estilos para os bot√µes de a√ß√£o do documento */
    .doc-actions-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    
    .doc-action-btn {
      flex: 1;
      min-width: 120px;
      max-width: 200px;
      padding: 12px 15px;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    
    .doc-action-btn i {
      font-size: 16px;
    }
    
    .doc-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .doc-action-btn:active {
      transform: translateY(1px);
    }
  </style>
</head>
<body class="login-bg">
  <!-- TELA DE LOGIN -->
  <div class="login-container" id="loginContainer">
    <div class="login-logo">
      <img src="https://i.postimg.cc/HsqLXz2t/LOGO-2-AZUL.png" alt="Flow Easy" class="logo-img">
    </div>
    <div class="message error-message" id="errorMessage">
      Email ou senha incorretos. Tente novamente.
    </div>
    <div class="message success-message" id="successMessage">
      Login realizado com sucesso! Redirecionando...
    </div>
    <form id="loginForm">
      <div class="input-group">
        <input type="email" id="email" placeholder=" " required />
        <label for="email">E-mail</label>
      </div>
      <div class="input-group">
        <input type="password" id="password" placeholder=" " required />
        <label for="password">Senha</label>
      </div>
      <button type="submit" class="login-btn">Entrar</button>
    </form>
  </div>

  <!-- TELA DO MENU LATERAL -->
  <div class="menu-container hidden" id="menuContainer">
    <button id="mobileMenuToggle">‚ò∞</button>
    <button id="themeToggle" class="theme-toggle">üåì</button>
    <div class="menu-overlay" id="menuOverlay"></div>
    <div class="sidebar" id="sidebar">
      <div>
        <div class="logo">
          <img src="https://i.postimg.cc/HsqLXz2t/LOGO-2-AZUL.png" alt="Flow Easy" class="logo-img">
        </div>
        <nav class="menu">
          <a href="#" data-content="dashboard" class="active">&#128200; Dashboard</a>
          <a href="#" data-content="gerar-documentos">&#128196; Gerar documentos</a>
          <a href="#" data-content="relatorios">&#128202; Relat√≥rios</a>
          <a href="#" data-content="modelos">&#128193; Modelos</a>
        </nav>
      </div>
      <div class="sidebar-footer">
        <div class="user-info" id="userInfoContainer">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-details">
            <div class="user-name" id="userNameDisplay">Usu√°rio</div>
            <div class="user-role" id="userRoleDisplay">Cargo</div>
          </div>
        </div>
        <button class="logout-btn" id="logoutButton">&#128682; Sair</button>
      </div>
    </div>
    <div class="main-content" id="mainContent">
      <h1>Bem-vindo ao Flow Easy</h1>
      <p>Selecione uma op√ß√£o no menu lateral para come√ßar.</p>
    </div>
  </div>

  <script>
    // Refer√™ncias aos elementos
    const loginContainer = document.getElementById('loginContainer');
    const menuContainer = document.getElementById('menuContainer');
    const mainContent = document.getElementById('mainContent');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const sidebar = document.getElementById('sidebar');
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const menuOverlay = document.getElementById('menuOverlay');
    const themeToggle = document.getElementById('themeToggle');

    // Configura√ß√£o de URLs de webhook do n8n
    const n8nWebhooks = {
      cpfConsulta: 'https://app.floweasysetup.com.br/webhook/cpf-consulta', // Webhook para consulta de CPF
      documentoGerar: 'https://app.floweasysetup.com.br/webhook/documento-gerar', // Webhook para gerar documento
      autenticacao: 'https://app.floweasysetup.com.br/webhook/autenticar', // Webhook para autentica√ß√£o
      dashboard: 'https://app.floweasysetup.com.br/webhook/dashboard', // Webhook para dados do dashboard
      modelos: 'https://app.floweasysetup.com.br/webhook/modelos' // Webhook para gerenciamento de modelos
    };

    // Controle do Tema (Claro/Escuro)
    function setupThemeToggle() {
      // Verificar prefer√™ncia do usu√°rio no localStorage
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '‚òÄÔ∏è'; // Emoji de sol para mudar para tema claro
      } else {
        themeToggle.textContent = 'üåì'; // Emoji de lua para mudar para tema escuro
      }

      // Configurar evento para alternar o tema
      themeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        let newTheme;
        
        if (currentTheme === 'dark') {
          newTheme = 'light';
          themeToggle.textContent = 'üåì';
          document.documentElement.removeAttribute('data-theme');
        } else {
          newTheme = 'dark';
          themeToggle.textContent = '‚òÄÔ∏è';
          document.documentElement.setAttribute('data-theme', 'dark');
        }
        
        // Salvar prefer√™ncia no localStorage
        localStorage.setItem('theme', newTheme);
      });
    }

    // Adicionar controles para o menu mobile
    function setupMobileMenu() {
      // Toggle menu quando clica no bot√£o
      mobileMenuToggle.addEventListener('click', toggleMobileMenu);
      
      // Fechar menu quando clica no overlay
      menuOverlay.addEventListener('click', closeMobileMenu);
      
      // Fechar menu quando a janela √© redimensionada para desktop
      window.addEventListener('resize', function() {
        if (window.innerWidth > 992) {
          closeMobileMenu();
        }
      });
      
      // Fechar menu quando clica em um link do menu (em mobile)
      document.querySelectorAll('.menu a').forEach(link => {
        link.addEventListener('click', function() {
          if (window.innerWidth <= 992) {
            closeMobileMenu();
          }
        });
      });
    }
    
    // Fun√ß√£o para alternar a visibilidade do menu mobile
    function toggleMobileMenu() {
      sidebar.classList.toggle('active');
      menuOverlay.classList.toggle('active');
      document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
    }
    
    // Fun√ß√£o para fechar o menu mobile
    function closeMobileMenu() {
      sidebar.classList.remove('active');
      menuOverlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    // Conte√∫dos das p√°ginas (usando strings em uma linha)
    const pages = {
      'dashboard': `
        <h1>Dashboard</h1>
        <p>Bem-vindo ao Dashboard! Aqui voc√™ pode ver um resumo geral.</p>
        
        <div id="dashboard-loading" style="text-align: center; padding: 40px;">
          <p style="margin-bottom: 15px;">Carregando dados do dashboard...</p>
          <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        </div>
        
        <style>
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
          
          .dashboard-container {
            display: none;
          }
          
          .dashboard-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
          }

          .filter-container {
            display: none; /* Ocultar completamente em vez de remover, para evitar problemas com refer√™ncias */
          }

          .filter-container label {
            display: none;
          }

          .periodo-select, .data-input {
            display: none;
          }

          .datas-personalizado {
            display: none !important;
          }

          .apply-btn {
            display: none;
          }

          .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
          }
          
          .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.3s ease;
          }
          
          .stat-card:hover {
            transform: translateY(-5px);
          }
          
          .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #0c3c82;
            margin: 10px 0;
          }
          
          .stat-label {
            color: #666;
            font-size: 14px;
          }
          
          .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
          }
          
          .chart-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
          }
          
          .chart-title {
            font-size: 18px;
            color: #0c3c82;
            margin-bottom: 15px;
            font-weight: 600;
          }
          
          .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
          }
          
          .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
          }
          
          .data-table th {
            font-weight: 600;
            color: #0c3c82;
          }
          
          .data-table tr:hover {
            background-color: #f8f9fa;
          }
          
          .bar-chart {
            display: flex;
            height: 200px;
            align-items: flex-end;
            margin-top: 40px;
            margin-bottom: 40px;
            padding-left: 40px;
            padding-right: 20px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
          }
          
          .bar {
            flex: 1;
            margin: 0 8px; /* Reduzindo de 15px para 8px */
            background: linear-gradient(to top, var(--primary-light), #64b5f6);
            min-width: 12px; /* Reduzindo de 15px para 12px */
            max-width: 20px; /* Reduzindo de 30px para 20px */
            margin-left: auto;
            margin-right: auto;
            border-radius: 5px 5px 0 0;
            position: relative;
          }
          
          .bar:after {
            content: attr(data-value);
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            white-space: nowrap;
            color: var(--text-color);
            text-align: center;
          }
          
          .bar:before {
            content: attr(data-label);
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%) rotate(-15deg);
            font-size: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 65px;
            color: var(--text-color);
            text-align: center;
          }
          
          .chart-box {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 25px;
          }
          
          .recent-activity {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-top: 10px;
            margin-bottom: 30px;
          }
        </style>
        
        <div id="dashboard-container" class="dashboard-container">
          <div class="dashboard-controls">
            <div class="control-group">
              <button id="refresh-dashboard" class="refresh-btn">Atualizar Dashboard</button>
              <button id="export-pdf" class="export-btn">Exportar PDF</button>
            </div>
          </div>
          
          <div class="stats-cards">
            <div class="stat-card">
              <div class="stat-value" id="total-documentos">0</div>
              <div class="stat-label">Total de Documentos</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="total-usuarios">0</div>
              <div class="stat-label">Usu√°rios Ativos</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="total-consultas">0</div>
              <div class="stat-label">Consultas CPF</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="media-diaria">0</div>
              <div class="stat-label">M√©dia Di√°ria</div>
            </div>
          </div>
          
          <div class="chart-container">
            <div class="chart-box">
              <div class="chart-title">Documentos por Status</div>
              <div id="status-chart" class="bar-chart"></div>
            </div>
            <div class="chart-box">
              <div class="chart-title">Documentos por Tipo</div>
              <div id="tipo-chart" class="bar-chart"></div>
            </div>
          </div>
          
          <div class="chart-box">
            <div class="chart-title">Documentos por M√™s</div>
            <div id="mes-chart" class="bar-chart"></div>
          </div>
          
          <div class="recent-activity">
            <div class="chart-title">Usu√°rios mais Ativos</div>
            <div class="data-table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Documentos Gerados</th>
                  </tr>
                </thead>
                <tbody id="usuarios-ativos-tbody">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `,
      'gerar-documentos': ""
        + "<h1>Gerar Documentos</h1>"
        + "<p>Aqui voc√™ pode gerar documentos personalizados para seus clientes. "
        + "Escolha uma das rotas abaixo para preencher automaticamente o documento.</p>"
        + "<div class='button-grid'>"
          + "<button class='route-btn' data-route='rota1'>Procura√ß√£o</button>"
          + "<button class='route-btn' data-route='rota2'>Contrato presta√ß√£o de servi√ßos</button>"
          + "<button class='route-btn' data-route='rota3'>Declara√ß√£o de resid√™ncia</button>"
          + "<button class='route-btn' data-route='rota4'>Declara√ß√£o de separa√ß√£o de fato</button>"
          + "<button class='route-btn' data-route='rota5'>Requerimento do BPC e Composi√ß√£o familiar</button>"
          + "<button class='route-btn' data-route='rota6'>Termo de consentimento LGPD</button>"
          + "<button class='route-btn' data-route='rota7'>Termo de Representa√ß√£o Previdenci√°ria</button>"
          + "<button class='route-btn' data-route='rota8'>Termo de Responsabilidade</button>"
        + "</div>"
        /* √Årea para exibir dados da pessoa */
        + "<div id='pessoaDadosContainer' style='display: none; margin: 30px 0; padding: 20px; background-color: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);'>"
          + "<h2 style='color: #0c3c82; margin-bottom: 15px;'>Dados da Pessoa</h2>"
          + "<div id='pessoaDados'></div>"
          + "<div style='display: flex; justify-content: space-between; margin-top: 20px;'>"
            + "<button id='preencherDocumentoBtn' class='popup-btn popup-btn-primary'>Preencher Documento</button>"
            + "<button id='novaPesquisaBtn' class='popup-btn popup-btn-secondary'>Nova Consulta</button>"
          + "</div>"
        + "</div>"
        /* √Årea para exibir o documento gerado */
        + "<div id='documentoGeradoContainer' style='display: none; margin: 30px 0; padding: 20px; background-color: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);'>"
          + "<h2 style='color: #0c3c82; margin-bottom: 15px;'>Documento Gerado</h2>"
          + "<div id='documentoAcoesContainer' style='display: flex; justify-content: space-between; margin-bottom: 15px;'>"
            + "<div>"
              + "<span id='statusDocumento' style='font-weight: bold; color: #4caf50;'>Gerado com sucesso</span>"
            + "</div>"
            + "<div>"
              + "<button id='gerarAssinaturaBtn' class='popup-btn popup-btn-primary' style='margin-right: 10px; background: linear-gradient(135deg, #2e7d32, #4caf50);'>Gerar Assinatura Digital</button>"
              + "<button id='abrirNovaAbaBtn' class='popup-btn popup-btn-secondary' style='margin-right: 10px;'>Editar documento</button>"
              + "<button id='voltarBtn' class='popup-btn popup-btn-primary'>Voltar</button>"
            + "</div>"
          + "</div>"
          + "<div id='documentoInfoContainer' style='background-color: #f5f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #0c3c82;'>"
            + "<div style='display: flex; flex-wrap: wrap; gap: 20px;'>"
              + "<div style='flex: 1; min-width: 250px;'>"
                + "<h3 style='font-size: 16px; margin-bottom: 10px; color: #0c3c82;'>Detalhes do Documento</h3>"
                + "<p><strong>Nome do arquivo:</strong> <span id='documentoNome'>documento.pdf</span></p>"
                + "<p><strong>Tipo:</strong> <span id='documentoTipo'>Documento</span></p>"
                + "<p><strong>Gerado em:</strong> <span id='documentoData'></span></p>"
              + "</div>"
              + "<div style='flex: 1; min-width: 250px;'>"
                + "<h3 style='font-size: 16px; margin-bottom: 10px; color: #0c3c82;'>Dados do Cliente</h3>"
                + "<p><strong>Nome:</strong> <span id='clienteNome'>-</span></p>"
                + "<p><strong>CPF:</strong> <span id='clienteCpf'>-</span></p>"
                + "<p><strong>Endere√ßo:</strong> <span id='clienteEndereco'>-</span></p>"
              + "</div>"
            + "</div>"
          + "</div>"
          + "<div id='documentoPreviewContainer' style='width: 100%; height: 700px; border: 1px solid #e0e0e0; border-radius: 5px; overflow: hidden;'>"
            + "<iframe id='documentoIframe' style='width: 100%; height: 100%; border: none;'></iframe>"
          + "</div>"
        + "</div>"
        /* Adicionando os popups */
        + "<div class='popup-overlay' id='cpfPopup'>"
          + "<div class='popup-content'>"
            + "<div class='popup-title'>Digite o CPF para consultar</div>"
            + "<input type='text' class='popup-input' id='cpfInput' placeholder='Ex: 000.000.000-00'>"
            + "<div class='popup-buttons'>"
              + "<button class='popup-btn popup-btn-primary' id='submitCpfBtn'>Consultar</button>"
              + "<button class='popup-btn popup-btn-secondary' id='cancelCpfBtn'>Cancelar</button>"
            + "</div>"
          + "</div>"
        + "</div>"
        + "<div class='popup-overlay' id='confirmPopup'>"
          + "<div class='popup-content'>"
            + "<div class='popup-title'>Deseja preencher o documento automaticamente?</div>"
            + "<p style='margin-bottom: 15px;'>O documento ser√° preenchido com os dados da pessoa consultada e salvo no sistema.</p>"
            + "<div class='popup-buttons'>"
              + "<button class='popup-btn popup-btn-primary' id='confirmYesBtn'>Sim</button>"
              + "<button class='popup-btn popup-btn-secondary' id='confirmNoBtn'>N√£o</button>"
            + "</div>"
          + "</div>"
        + "</div>"
        /* Adicionando aviso personalizado */
        + "<div class='popup-overlay' id='avisoPopup'>"
          + "<div class='popup-content'>"
            + "<div style='text-align: center; margin-bottom: 15px;'>"
              + "<i style='font-size: 48px; color: #e74c3c;'>&#9888;</i>"
            + "</div>"
            + "<div class='popup-title' id='avisoTitulo'>Informa√ß√£o</div>"
            + "<p style='margin-bottom: 15px; text-align: center;' id='avisoMensagem'>Mensagem de aviso aqui.</p>"
            + "<div class='popup-buttons' style='justify-content: center;'>"
              + "<button class='popup-btn popup-btn-primary' id='avisoOkBtn'>OK</button>"
            + "</div>"
          + "</div>"
        + "</div>",
      'relatorios': "<h1>Relat√≥rios</h1><p>Visualize aqui relat√≥rios de uso, desempenho e muito mais.</p>",
      'modelos': `<h1>Modelos de Documentos</h1>
        <p>Gerencie seus modelos de documentos para preenchimento autom√°tico.</p>
        
        <div class="models-container">
          <div class="models-upload-section">
            <h2>Enviar Novo Modelo</h2>
            <form id="uploadModelForm" class="upload-form">
              <div class="form-group">
                <label for="modelName">Nome do Modelo</label>
                <input type="text" id="modelName" name="modelName" placeholder="Ex: Contrato de Presta√ß√£o de Servi√ßos" required>
              </div>
              <div class="form-group">
                <label for="modelDescription">Descri√ß√£o (opcional)</label>
                <textarea id="modelDescription" name="modelDescription" placeholder="Descreva para que serve este modelo"></textarea>
              </div>
              <div class="form-group">
                <label for="modelFile">Arquivo DOC</label>
                <input type="file" id="modelFile" name="modelFile" accept=".doc,.docx" required>
                <div class="file-info">Apenas arquivos DOC/DOCX s√£o aceitos. Tamanho m√°ximo: 10MB</div>
              </div>
              <div class="form-group">
                <label for="modelCategory">Categoria</label>
                <select id="modelCategory" name="modelCategory">
                  <option value="contrato">Contrato</option>
                  <option value="termo">Termo</option>
                  <option value="declaracao">Declara√ß√£o</option>
                  <option value="outro">Outro</option>
                </select>
              </div>
              <button type="submit" class="btn-primary" id="uploadModelBtn">Enviar Modelo</button>
            </form>
          </div>
          
          <div class="models-list-section">
            <h2>Modelos Dispon√≠veis</h2>
            <div class="models-filter">
              <input type="text" id="modelSearch" placeholder="Buscar modelo...">
              <select id="filterCategory">
                <option value="">Todas as categorias</option>
                <option value="contrato">Contratos</option>
                <option value="termo">Termos</option>
                <option value="declaracao">Declara√ß√µes</option>
                <option value="outro">Outros</option>
              </select>
            </div>
            
            <div id="modelsList" class="models-grid">
              <div class="models-loading">
                <p>Carregando modelos...</p>
              </div>
            </div>
          </div>
        </div>

        <style>
          .models-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
          }
          
          .models-upload-section, .models-list-section {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px var(--shadow-color);
          }
          
          .upload-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
          }
          
          .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
          }
          
          .form-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--text-color);
          }
          
          .form-group input[type="text"],
          .form-group select,
          .form-group textarea {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
          }
          
          .form-group textarea {
            min-height: 80px;
            resize: vertical;
          }
          
          .file-info {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 5px;
          }
          
          .models-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
          }
          
          .models-filter input {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
          }
          
          .models-filter select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
          }
          
          .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
          }
          
          .model-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            background-color: var(--card-bg);
            transition: all 0.3s ease;
            position: relative;
          }
          
          .model-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
          }
          
          .model-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-color);
          }
          
          .model-description {
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
          }
          
          .model-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 10px;
          }
          
          .model-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
          }
          
          .model-actions button {
            padding: 6px 10px;
            font-size: 12px;
            border-radius: 4px;
            background-color: var(--button-secondary-bg);
            color: var(--button-secondary-text);
            border: none;
            cursor: pointer;
          }
          
          .model-actions button.download {
            background-color: var(--primary-color);
            color: white;
          }
          
          .models-loading {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
          }
          
          @media (max-width: 992px) {
            .models-container {
              grid-template-columns: 1fr;
            }
          }
        </style>`
    };

    // Clique nos links do menu
    const menuLinks = document.querySelectorAll('.menu a');
    menuLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        // Remover classe active de todos os links
        menuLinks.forEach(l => l.classList.remove('active'));
        // Adicionar classe active ao link clicado
        link.classList.add('active');
        
        const contentKey = link.getAttribute('data-content');
        if (pages[contentKey]) {
          mainContent.innerHTML = pages[contentKey];
          // Se for gerar-documentos, configura os bot√µes
          if (contentKey === 'gerar-documentos') {
            setTimeout(setupGerarDocumentosLogic, 50);
          } else if (contentKey === 'dashboard') {
            setTimeout(setupDashboardLogic, 50);
          } else if (contentKey === 'modelos') {
            setTimeout(setupModelosLogic, 50);
          }
        } else {
          mainContent.innerHTML = "<h1>P√°gina n√£o encontrada</h1><p>O conte√∫do n√£o existe.</p>";
        }
      });
    });

    // Fun√ß√£o para configurar e carregar o Dashboard
    async function setupDashboardLogic() {
      const dashboardLoading = document.getElementById('dashboard-loading');
      const dashboardContainer = document.getElementById('dashboard-container');
      const refreshBtn = document.getElementById('refresh-dashboard');
      const exportPdfBtn = document.getElementById('export-pdf');
      
      if (!refreshBtn) return; // Se n√£o encontrar os elementos, n√£o faz nada
      
      // Configurar evento do bot√£o exportar PDF
      exportPdfBtn.addEventListener('click', exportToPDF);
      
      // Fun√ß√£o para exportar o dashboard para PDF
      async function exportToPDF() {
        try {
          // Mostrar mensagem de loading
          const exportStatus = document.createElement('div');
          exportStatus.className = 'export-status';
          exportStatus.textContent = 'Gerando PDF, aguarde...';
          exportStatus.style.position = 'fixed';
          exportStatus.style.top = '50%';
          exportStatus.style.left = '50%';
          exportStatus.style.transform = 'translate(-50%, -50%)';
          exportStatus.style.padding = '15px 20px';
          exportStatus.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
          exportStatus.style.color = 'white';
          exportStatus.style.borderRadius = '5px';
          exportStatus.style.zIndex = '9999';
          document.body.appendChild(exportStatus);
          
          // Precisamos esperar um pouco para garantir que o DOM esteja atualizado
          await new Promise(resolve => setTimeout(resolve, 100));
          
          // Capturar cada se√ß√£o do dashboard separadamente para melhor qualidade
          const dashContent = document.getElementById('dashboard-container');
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF('p', 'mm', 'a4');
          const width = doc.internal.pageSize.getWidth();
          const height = doc.internal.pageSize.getHeight();
          
          // Adicionar t√≠tulo
          doc.setFontSize(20);
          doc.setTextColor(12, 60, 130); // Cor prim√°ria
          doc.text('Relat√≥rio Dashboard Flow Easy', width / 2, 15, { align: 'center' });
          
          // Adicionar data do relat√≥rio
          doc.setFontSize(10);
          doc.setTextColor(100, 100, 100);
          const hoje = new Date().toLocaleDateString('pt-BR');
          doc.text(`Gerado em: ${hoje}`, width / 2, 22, { align: 'center' });
          
          // Adicionar informa√ß√µes do per√≠odo - agora apenas "todos os dados"
          doc.setFontSize(11);
          const periodoInfo = 'Per√≠odo: Todos os dados';
          doc.text(periodoInfo, width / 2, 30, { align: 'center' });
          
          // Capturar os cards de estat√≠sticas
          const statsCards = document.querySelector('.stats-cards');
          const statsCanvas = await html2canvas(statsCards, { scale: 2 });
          const statsImgData = statsCanvas.toDataURL('image/png');
          
          // Adicionar os cards de estat√≠sticas ao PDF
          doc.text('Resumo Estat√≠stico', 14, 40);
          const statsImgWidth = width - 28;
          const statsImgHeight = (statsCanvas.height * statsImgWidth) / statsCanvas.width;
          doc.addImage(statsImgData, 'PNG', 14, 43, statsImgWidth, statsImgHeight);
          
          // Definir posi√ß√£o Y para o pr√≥ximo elemento
          let currentY = 43 + statsImgHeight + 10;
          
          // Verificar se precisa adicionar nova p√°gina
          if (currentY > height - 40) {
            doc.addPage();
            currentY = 15;
          }
          
          // Capturar o gr√°fico de documentos por status
          try {
            const statusChart = document.querySelector('.chart-box:nth-child(1)');
            const statusCanvas = await html2canvas(statusChart, { scale: 2 });
            const statusImgData = statusCanvas.toDataURL('image/png');
            
            // Adicionar o gr√°fico de status ao PDF
            doc.text('Documentos por Status', 14, currentY);
            const statusImgWidth = width - 28;
            const statusImgHeight = (statusCanvas.height * statusImgWidth) / statusCanvas.width;
            doc.addImage(statusImgData, 'PNG', 14, currentY + 3, statusImgWidth, statusImgHeight);
            
            // Atualizar posi√ß√£o Y
            currentY += statusImgHeight + 13;
            
            // Verificar se precisa adicionar nova p√°gina
            if (currentY > height - 40) {
              doc.addPage();
              currentY = 15;
            }
          } catch (error) {
            console.error('Erro ao capturar gr√°fico de status:', error);
          }
          
          // Capturar o gr√°fico de documentos por tipo
          try {
            const tipoChart = document.querySelector('.chart-box:nth-child(2)');
            const tipoCanvas = await html2canvas(tipoChart, { scale: 2 });
            const tipoImgData = tipoCanvas.toDataURL('image/png');
            
            // Adicionar o gr√°fico de tipo ao PDF
            doc.text('Documentos por Tipo', 14, currentY);
            const tipoImgWidth = width - 28;
            const tipoImgHeight = (tipoCanvas.height * tipoImgWidth) / tipoCanvas.width;
            doc.addImage(tipoImgData, 'PNG', 14, currentY + 3, tipoImgWidth, tipoImgHeight);
            
            // Atualizar posi√ß√£o Y
            currentY += tipoImgHeight + 13;
            
            // Verificar se precisa adicionar nova p√°gina
            if (currentY > height - 40) {
              doc.addPage();
              currentY = 15;
            }
          } catch (error) {
            console.error('Erro ao capturar gr√°fico de tipo:', error);
          }
          
          // Capturar o gr√°fico de documentos por m√™s
          try {
            const mesChart = document.querySelector('.chart-box:nth-child(3)');
            const mesCanvas = await html2canvas(mesChart, { scale: 2 });
            const mesImgData = mesCanvas.toDataURL('image/png');
            
            // Adicionar o gr√°fico de m√™s ao PDF
            doc.text('Documentos por M√™s', 14, currentY);
            const mesImgWidth = width - 28;
            const mesImgHeight = (mesCanvas.height * mesImgWidth) / mesCanvas.width;
            doc.addImage(mesImgData, 'PNG', 14, currentY + 3, mesImgWidth, mesImgHeight);
            
            // Atualizar posi√ß√£o Y
            currentY += mesImgHeight + 13;
            
            // Verificar se precisa adicionar nova p√°gina
            if (currentY > height - 40) {
              doc.addPage();
              currentY = 15;
            }
          } catch (error) {
            console.error('Erro ao capturar gr√°fico de m√™s:', error);
          }
          
          // Capturar a tabela de usu√°rios mais ativos
          try {
            const usuariosTable = document.querySelector('.recent-activity');
            const usuariosCanvas = await html2canvas(usuariosTable, { scale: 2 });
            const usuariosImgData = usuariosCanvas.toDataURL('image/png');
            
            // Adicionar a tabela de usu√°rios ao PDF
            doc.text('Usu√°rios mais Ativos', 14, currentY);
            const usuariosImgWidth = width - 28;
            const usuariosImgHeight = (usuariosCanvas.height * usuariosImgWidth) / usuariosCanvas.width;
            doc.addImage(usuariosImgData, 'PNG', 14, currentY + 3, usuariosImgWidth, usuariosImgHeight);
          } catch (error) {
            console.error('Erro ao capturar tabela de usu√°rios:', error);
          }
          
          // Adicionar rodap√© com informa√ß√µes da empresa
          doc.setFontSize(8);
          doc.setTextColor(100, 100, 100);
          doc.text('Flow Easy - Sistema de Gest√£o de Documentos', width / 2, height - 10, { align: 'center' });
          doc.text(`P√°gina 1 de ${doc.getNumberOfPages()}`, width - 20, height - 10);
          
          // Definir cabe√ßalho e rodap√© para todas as p√°ginas
          for (let i = 2; i <= doc.getNumberOfPages(); i++) {
            doc.setPage(i);
            doc.setFontSize(10);
            doc.setTextColor(12, 60, 130);
            doc.text('Relat√≥rio Dashboard Flow Easy', width / 2, 10, { align: 'center' });
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text('Flow Easy - Sistema de Gest√£o de Documentos', width / 2, height - 10, { align: 'center' });
            doc.text(`P√°gina ${i} de ${doc.getNumberOfPages()}`, width - 20, height - 10);
          }
          
          // Salvar o PDF
          const dataAtual = new Date().toISOString().replace(/[:.]/g, '-');
          doc.save(`dashboard-flow-easy-${dataAtual}.pdf`);
          
          // Remover mensagem de loading
          document.body.removeChild(exportStatus);
          
        } catch (error) {
          console.error('Erro ao exportar PDF:', error);
          alert('Erro ao gerar o PDF. Tente novamente.');
          
          // Remover mensagem de loading se houver erro
          const exportStatus = document.querySelector('.export-status');
          if (exportStatus) {
            document.body.removeChild(exportStatus);
          }
        }
      }
      
      // Fun√ß√£o para carregar os dados do dashboard
      async function loadDashboardData() {
        try {
          dashboardLoading.style.display = 'block';
          dashboardContainer.style.display = 'none';
          
          // Simplificado para n√£o usar mais filtros
          let url = new URL(n8nWebhooks.dashboard);
          
          const response = await fetch(url, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
          });
          
          if (!response.ok) {
            throw new Error(`Erro ao carregar dados: ${response.status}`);
          }
          
          const rawData = await response.json();
          console.log("Dados recebidos:", rawData);
          
          // Extrair os dados do array se vier como array
          const responseData = Array.isArray(rawData) ? rawData[0] : rawData;
          
          // Verificar se temos dados v√°lidos
          if (!responseData || !responseData.data) {
            throw new Error('Formato de dados inv√°lido recebido do servidor');
          }
          
          // Usamos diretamente os dados sem processamento adicional,
          // j√° que eles j√° v√™m no formato correto
          const dashboardData = {
            success: responseData.success || true,
            data: responseData.data
          };
          
          if (!dashboardData.success) {
            throw new Error(dashboardData.message || 'Erro ao carregar dados do dashboard');
          }
          
          updateDashboardUI(dashboardData.data);
          dashboardLoading.style.display = 'none';
          dashboardContainer.style.display = 'block';
          
          // Mostrar texto informativo fixo do per√≠odo
          const periodoInfo = document.createElement('div');
          periodoInfo.className = 'periodo-info';
          periodoInfo.innerHTML = '<p style="margin-bottom: 20px; font-style: italic; color: var(--text-secondary);">Exibindo dados de todo o per√≠odo</p>';
          
          // Verificar se j√° existe um elemento de per√≠odo info e remov√™-lo antes de adicionar o novo
          const periodoInfoExistente = document.querySelector('.periodo-info');
          if (periodoInfoExistente) {
            periodoInfoExistente.remove();
          }
          
          // Inserir ap√≥s o controle de filtros
          document.querySelector('.dashboard-controls').after(periodoInfo);
          
        } catch (error) {
          console.error('Erro ao carregar dashboard:', error);
          alert(`N√£o foi poss√≠vel carregar o dashboard: ${error.message}`);
          
          // Mesmo com erro, esconde o loading e mostra o container com dados zerados
          dashboardLoading.style.display = 'none';
          dashboardContainer.style.display = 'block';
        }
      }
      
      // Atualizar o dashboard quando clicar no bot√£o
      refreshBtn.addEventListener('click', loadDashboardData);
      
      // Fun√ß√£o para processar o array bruto retornado pelo n8n
      function processarDadosBrutos(dadosBrutos) {
        // Se os dados vieram no formato esperado ou como null/undefined, retorna como est√°
        if (!dadosBrutos || typeof dadosBrutos !== 'object') {
          console.error('Dados inv√°lidos recebidos:', dadosBrutos);
          return {
            resumo: {},
            documentos_por_status: [],
            documentos_por_tipo: [],
            documentos_por_mes: [],
            usuarios_ativos: []
          };
        }
        
        // Se j√° estiver no formato correto (com as propriedades esperadas), retorna diretamente
        if (dadosBrutos.resumo && dadosBrutos.documentos_por_status && 
            dadosBrutos.documentos_por_tipo && dadosBrutos.documentos_por_mes && 
            dadosBrutos.usuarios_ativos) {
          return dadosBrutos;
        }
        
        // Se chegou aqui, precisa organizar os dados nas categorias corretas
        console.log('Dados precisam ser processados:', dadosBrutos);
        
        // Inicializa estrutura de dados padr√£o
        const resultado = {
          resumo: {},
          documentos_por_status: [],
          documentos_por_tipo: [],
          documentos_por_mes: [],
          usuarios_ativos: []
        };
        
        try {
          // Se os dados estiverem em um array, tenta processar itens individuais
          if (Array.isArray(dadosBrutos)) {
            dadosBrutos.forEach(item => {
              if (item.tipo_documento) {
                resultado.documentos_por_tipo.push(item);
              } else if (item.status) {
                resultado.documentos_por_status.push(item);
              } else if (item.total_documentos !== undefined) {
                resultado.resumo = item;
              } else if (item.mes) {
                resultado.documentos_por_mes.push(item);
              } else if (item.usuario) {
                resultado.usuarios_ativos.push(item);
              }
            });
          }
        } catch (error) {
          console.error('Erro ao processar dados brutos:', error);
        }
        
        return resultado;
      }
      
      // Fun√ß√£o para atualizar a UI do dashboard com os dados recebidos
      function updateDashboardUI(data) {
        // Atualizar os cart√µes com totais
        document.getElementById('total-documentos').textContent = formatNumber(data.resumo.total_documentos || 0);
        document.getElementById('total-usuarios').textContent = formatNumber(data.resumo.total_usuarios || 0);
        document.getElementById('total-consultas').textContent = formatNumber(data.resumo.total_consultas || 0);
        document.getElementById('media-diaria').textContent = formatNumber(data.resumo.media_diaria || 0, 1);
        
        // Criar tooltip para os gr√°ficos se n√£o existir
        let tooltip = document.querySelector('.tooltip');
        if (!tooltip) {
          tooltip = document.createElement('div');
          tooltip.className = 'tooltip';
          document.body.appendChild(tooltip);
        }
        
        // Gr√°fico de documentos por status
        const statusChart = document.getElementById('status-chart');
        statusChart.innerHTML = '';
        
        // Adicionar container para os gr√°ficos
        const statusContainer = document.createElement('div');
        statusContainer.className = 'bar-chart-container';
        statusChart.appendChild(statusContainer);
        
        // Adicionar indicador de rolagem se necess√°rio
        const statusScrollIndicator = document.createElement('div');
        statusScrollIndicator.className = 'scroll-indicator';
        statusScrollIndicator.textContent = '‚Üê Deslize para ver mais ‚Üí';
        statusChart.appendChild(statusScrollIndicator);
        
        if (data.documentos_por_status && data.documentos_por_status.length) {
          const maxValue = Math.max(...data.documentos_por_status.map(item => item.quantidade));
          data.documentos_por_status.forEach(status => {
            const percent = (status.quantidade / maxValue) * 100;
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.height = `${percent}%`;
            bar.setAttribute('data-value', formatNumber(status.quantidade));
            bar.setAttribute('data-label', status.status);
            bar.setAttribute('data-percent', `${Math.round(percent)}%`);
            
            // Adicionar eventos para tooltips
            bar.addEventListener('mousemove', function(e) {
              showTooltip(e, this, tooltip, data.resumo.total_documentos);
            });
            
            bar.addEventListener('mouseleave', function() {
              tooltip.classList.remove('show');
            });
            
            // Suporte para eventos touch (mobile)
            bar.addEventListener('touchstart', function(e) {
              showTooltip(e, this, tooltip, data.resumo.total_documentos);
              e.preventDefault(); // Prevenir scroll em dispositivos touch
            });
            
            statusContainer.appendChild(bar);
          });
          
          // Mostrar ou ocultar indicador de rolagem
          setTimeout(() => {
            statusScrollIndicator.style.display = statusContainer.scrollWidth > statusChart.clientWidth ? 'block' : 'none';
          }, 100);
        } else {
          statusContainer.innerHTML = '<p style="text-align: center; padding: 20px; width: 100%;">Nenhum dado dispon√≠vel</p>';
          statusScrollIndicator.style.display = 'none';
        }
        
        // Gr√°fico de documentos por tipo
        const tipoChart = document.getElementById('tipo-chart');
        tipoChart.innerHTML = '';
        
        // Adicionar container para os gr√°ficos
        const tipoContainer = document.createElement('div');
        tipoContainer.className = 'bar-chart-container';
        tipoChart.appendChild(tipoContainer);
        
        // Adicionar indicador de rolagem se necess√°rio
        const tipoScrollIndicator = document.createElement('div');
        tipoScrollIndicator.className = 'scroll-indicator';
        tipoScrollIndicator.textContent = '‚Üê Deslize para ver mais ‚Üí';
        tipoChart.appendChild(tipoScrollIndicator);
        
        if (data.documentos_por_tipo && data.documentos_por_tipo.length) {
          const maxValue = Math.max(...data.documentos_por_tipo.map(item => item.quantidade));
          data.documentos_por_tipo.forEach(tipo => {
            const percent = (tipo.quantidade / maxValue) * 100;
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.height = `${percent}%`;
            bar.setAttribute('data-value', formatNumber(tipo.quantidade));
            bar.setAttribute('data-label', tipo.tipo_documento);
            bar.setAttribute('data-percent', `${Math.round(percent)}%`);
            
            // Adicionar eventos para tooltips
            bar.addEventListener('mousemove', function(e) {
              showTooltip(e, this, tooltip, data.resumo.total_documentos);
            });
            
            bar.addEventListener('mouseleave', function() {
              tooltip.classList.remove('show');
            });
            
            // Suporte para eventos touch (mobile)
            bar.addEventListener('touchstart', function(e) {
              showTooltip(e, this, tooltip, data.resumo.total_documentos);
              e.preventDefault();
            });
            
            tipoContainer.appendChild(bar);
          });
          
          // Mostrar ou ocultar indicador de rolagem
          setTimeout(() => {
            tipoScrollIndicator.style.display = tipoContainer.scrollWidth > tipoChart.clientWidth ? 'block' : 'none';
          }, 100);
        } else {
          tipoContainer.innerHTML = '<p style="text-align: center; padding: 20px; width: 100%;">Nenhum dado dispon√≠vel</p>';
          tipoScrollIndicator.style.display = 'none';
        }
        
        // Gr√°fico de documentos por m√™s
        const mesChart = document.getElementById('mes-chart');
        mesChart.innerHTML = '';
        
        // Adicionar container para os gr√°ficos
        const mesContainer = document.createElement('div');
        mesContainer.className = 'bar-chart-container';
        mesChart.appendChild(mesContainer);
        
        // Adicionar indicador de rolagem se necess√°rio
        const mesScrollIndicator = document.createElement('div');
        mesScrollIndicator.className = 'scroll-indicator';
        mesScrollIndicator.textContent = '‚Üê Deslize para ver mais ‚Üí';
        mesChart.appendChild(mesScrollIndicator);
        
        if (data.documentos_por_mes && data.documentos_por_mes.length) {
          const maxValue = Math.max(...data.documentos_por_mes.map(item => item.quantidade));
          data.documentos_por_mes.forEach(mes => {
            const percent = (mes.quantidade / maxValue) * 100;
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.height = `${percent}%`;
            bar.setAttribute('data-value', formatNumber(mes.quantidade));
            // Formatar o m√™s para exibi√ß√£o (ex: 2023-01 -> Jan/23)
            const [ano, mesNum] = mes.mes.split('-');
            const mesNomes = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const mesFormatado = `${mesNomes[parseInt(mesNum)-1]}/${ano.slice(2)}`;
            bar.setAttribute('data-label', mesFormatado);
            bar.setAttribute('data-percent', `${Math.round(percent)}%`);
            bar.setAttribute('data-mes-completo', `${mesNomes[parseInt(mesNum)-1]} de ${ano}`);
            
            // Adicionar eventos para tooltips
            bar.addEventListener('mousemove', function(e) {
              showTooltip(e, this, tooltip, data.resumo.total_documentos);
            });
            
            bar.addEventListener('mouseleave', function() {
              tooltip.classList.remove('show');
            });
            
            // Suporte para eventos touch (mobile)
            bar.addEventListener('touchstart', function(e) {
              showTooltip(e, this, tooltip, data.resumo.total_documentos);
              e.preventDefault();
            });
            
            mesContainer.appendChild(bar);
          });
          
          // Mostrar ou ocultar indicador de rolagem
          setTimeout(() => {
            mesScrollIndicator.style.display = mesContainer.scrollWidth > mesChart.clientWidth ? 'block' : 'none';
          }, 100);
        } else {
          mesContainer.innerHTML = '<p style="text-align: center; padding: 20px; width: 100%;">Nenhum dado dispon√≠vel</p>';
          mesScrollIndicator.style.display = 'none';
        }
        
        // Tabela de usu√°rios mais ativos
        const usuariosAtivosTable = document.getElementById('usuarios-ativos-tbody');
        usuariosAtivosTable.innerHTML = '';
        if (data.usuarios_ativos && data.usuarios_ativos.length) {
          data.usuarios_ativos.forEach(usuario => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${usuario.usuario}</td>
              <td>${formatNumber(usuario.documentos_gerados)}</td>
            `;
            usuariosAtivosTable.appendChild(row);
          });
        } else {
          usuariosAtivosTable.innerHTML = '<tr><td colspan="2" style="text-align: center;">Nenhum dado dispon√≠vel</td></tr>';
        }
      }
      
      // Fun√ß√£o para exibir tooltip
      function showTooltip(event, bar, tooltip, totalDocumentos) {
        const label = bar.getAttribute('data-label');
        const value = bar.getAttribute('data-value');
        const percent = bar.getAttribute('data-percent');
        const mesCompleto = bar.getAttribute('data-mes-completo');
        
        // Calcular percentual do total de documentos
        const valorNumerico = parseInt(value.replace(/\D/g, ''));
        const percentualTotal = totalDocumentos ? ((valorNumerico / totalDocumentos) * 100).toFixed(1) + '%' : 'N/A';
        
        // Conte√∫do do tooltip
        let tooltipContent = `
          <strong>${mesCompleto || label}</strong><br>
          Quantidade: ${value}<br>
          Percentual do total: ${percentualTotal}<br>
          Altura no gr√°fico: ${percent}
        `;
        
        tooltip.innerHTML = tooltipContent;
        tooltip.classList.add('show');
        
        // Remover classe de posi√ß√£o para nova verifica√ß√£o
        tooltip.classList.remove('left-position');
        
        // Posicionar o tooltip
        const tooltipHeight = tooltip.offsetHeight;
        const tooltipWidth = tooltip.offsetWidth;
        
        // Verificar se o evento √© touch ou mouse
        let clientX, clientY;
        if (event.type === 'touchstart') {
          clientX = event.touches[0].clientX;
          clientY = event.touches[0].clientY;
        } else {
          clientX = event.clientX;
          clientY = event.clientY;
        }
        
        // Posicionar o tooltip pr√≥ximo ao cursor (5px de dist√¢ncia)
        tooltip.style.left = (clientX + 10) + 'px'; // 10px √† direita do cursor
        tooltip.style.top = (clientY - tooltipHeight/2) + 'px'; // Centralizado verticalmente com o cursor
        
        // Verificar se o tooltip est√° fora da tela horizontalmente
        const rightEdge = window.innerWidth;
        if (clientX + tooltipWidth + 15 > rightEdge) {
          // Se estiver saindo pela direita, mostrar √† esquerda do cursor
          tooltip.style.left = (clientX - tooltipWidth - 10) + 'px';
          tooltip.classList.add('left-position'); // Adicionar classe para posicionar seta corretamente
        }
        
        // Verificar se o tooltip est√° fora da tela verticalmente
        const topEdge = window.scrollY;
        const bottomEdge = window.scrollY + window.innerHeight;
        const tooltipTop = clientY - tooltipHeight/2;
        const tooltipBottom = tooltipTop + tooltipHeight;
        
        if (tooltipTop < topEdge) {
          // Se estiver saindo por cima, ajustar para ficar dentro da tela
          tooltip.style.top = (topEdge + 5) + 'px';
        } else if (tooltipBottom > bottomEdge) {
          // Se estiver saindo por baixo, ajustar para ficar dentro da tela
          tooltip.style.top = (bottomEdge - tooltipHeight - 5) + 'px';
        }
      }
      
      // Formatador de n√∫meros para exibi√ß√£o
      function formatNumber(number, decimals = 0) {
        if (isNaN(number)) return '0';
        return parseFloat(number).toLocaleString('pt-BR', {
          minimumFractionDigits: decimals,
          maximumFractionDigits: decimals
        });
      }
      
      // Carregar os dados iniciais
      loadDashboardData();
    }

    // L√≥gica para "Gerar Documentos"
    function setupGerarDocumentosLogic() {
      const routeBtns = document.querySelectorAll('.route-btn');
      const cpfPopup = document.getElementById('cpfPopup');
      const confirmPopup = document.getElementById('confirmPopup');
      const cpfInput = document.getElementById('cpfInput');
      const submitCpfBtn = document.getElementById('submitCpfBtn');
      const cancelCpfBtn = document.getElementById('cancelCpfBtn');
      const confirmYesBtn = document.getElementById('confirmYesBtn');
      const confirmNoBtn = document.getElementById('confirmNoBtn');
      const pessoaDadosContainer = document.getElementById('pessoaDadosContainer');
      const pessoaDados = document.getElementById('pessoaDados');
      const preencherDocumentoBtn = document.getElementById('preencherDocumentoBtn');
      const novaPesquisaBtn = document.getElementById('novaPesquisaBtn');

      let currentRoute = null;
      let currentRouteText = null;
      let userData = null;

      // Abrir popup de CPF quando clicar em uma rota
      routeBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          // Remover classe active de todos os bot√µes
          routeBtns.forEach(b => b.classList.remove('active'));
          // Adicionar classe active ao bot√£o clicado
          btn.classList.add('active');
          
          currentRoute = btn.getAttribute('data-route');
          currentRouteText = btn.textContent;
          cpfInput.value = '';
          
          // Mostrar popup de CPF
          cpfPopup.classList.add('active');
        });
      });

      // Cancelar consulta de CPF
      cancelCpfBtn.addEventListener('click', () => {
        cpfPopup.classList.remove('active');
        routeBtns.forEach(b => b.classList.remove('active'));
      });

      // Enviar CPF para consulta
      submitCpfBtn.addEventListener('click', async () => {
        const cpfValue = cpfInput.value.trim();
        if (!cpfValue) {
          mostrarAviso('Aten√ß√£o', 'Por favor, digite um CPF v√°lido.');
          return;
        }

        // Exibir indicador de carregamento (opcional)
        submitCpfBtn.disabled = true;
        submitCpfBtn.textContent = 'Consultando...';

        // Envio para o webhook do n8n
        const payload = {
          rota: currentRoute,
          rota_texto: currentRouteText,
          cpf: cpfValue,
          acao: 'consulta',
          usuario_id: sessionStorage.getItem('userId') || ''
        };

        try {
          // Fechar popup de CPF
          cpfPopup.classList.remove('active');
          
          const response = await fetch(n8nWebhooks.cpfConsulta, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          
          if (response.ok) {
            // Receber dados do n8n (que consultou o Supabase)
            userData = await response.json();
            
            // Verificar se dados foram encontrados
            if (userData.success === false) {
              mostrarAviso('CPF n√£o localizado', 'N√£o foi poss√≠vel encontrar os dados para este CPF. Verifique se o n√∫mero est√° correto ou tente com outro CPF.');
              routeBtns.forEach(b => b.classList.remove('active'));
              return;
            }
            
            // Mostrar dados da pessoa
            let dadosHTML = '';
            if (userData.dados) {
              dadosHTML += `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                  <div style="font-weight: bold;">Nome:</div>
                  <div>${userData.dados.nome || '-'}</div>
                  
                  <div style="font-weight: bold;">CPF:</div>
                  <div>${userData.dados.cpf || '-'}</div>
                  
                  <div style="font-weight: bold;">Data de Nascimento:</div>
                  <div>${userData.dados.data_nascimento || '-'}</div>
                  
                  <div style="font-weight: bold;">Endere√ßo:</div>
                  <div>${userData.dados.endereco || '-'}</div>
                  
                  <div style="font-weight: bold;">Telefone:</div>
                  <div>${userData.dados.telefone || '-'}</div>
                  
                  <div style="font-weight: bold;">Email:</div>
                  <div>${userData.dados.email || '-'}</div>
                </div>
              `;
          } else {
              dadosHTML = `<p>Dados encontrados, mas em formato inesperado.</p>
                          <pre style="text-align: left; background: #f5f5f5; padding: 10px; max-height: 200px; overflow: auto;">${JSON.stringify(userData, null, 2)}</pre>`;
            }
            
            pessoaDados.innerHTML = dadosHTML;
            pessoaDadosContainer.style.display = 'block';
            
            // N√£o mostrar popup de confirma√ß√£o automaticamente
            // Agora o usu√°rio precisa clicar no bot√£o "Preencher Documento"
          } else {
            const errorData = await response.json();
            alert(`Falha ao consultar os dados: ${errorData.message || 'Erro desconhecido'}`);
            routeBtns.forEach(b => b.classList.remove('active'));
          }
        } catch (err) {
          console.error(err);
          alert('Erro de rede ao consultar os dados. Verifique sua conex√£o.');
          routeBtns.forEach(b => b.classList.remove('active'));
        } finally {
          // Restaurar bot√£o
          submitCpfBtn.disabled = false;
          submitCpfBtn.textContent = 'Consultar';
        }
      });

      // Bot√£o "Sim" do popup de confirma√ß√£o
      confirmYesBtn.addEventListener('click', async () => {
        // Exibir indicador de carregamento (opcional)
        confirmYesBtn.disabled = true;
        confirmYesBtn.textContent = 'Processando...';
        
        try {
          const response = await fetch(n8nWebhooks.documentoGerar, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              acao: 'preencher',
              rota: currentRoute,
              rota_texto: currentRouteText,
              dados: userData,
              usuario_id: sessionStorage.getItem('userId') || null
            })
          });
          
          const result = await response.json();
          console.log("Resposta do servidor:", result);
          
          // Fechar o popup de confirma√ß√£o primeiro, independente do resultado
          confirmPopup.classList.remove('active');
          
          if (response.ok) {
            if (result.url_documento) {
              // Armazenar os dados do documento em vari√°veis globais
              // para garantir que ainda estejam dispon√≠veis ap√≥s fechar o aviso
              window.documentoGerado = {
                url: result.url_documento,
                nome: result.nome_documento || 'Documento',
                tipo: currentRouteText || 'Documento',
                documentId: result.documentId || result.url_documento.match(/\/d\/([^\/]+)/)?.[1] || '',
                mensagem: result.mensagem || 'Documento gerado com sucesso!'
              };
              
              // Fun√ß√£o espec√≠fica para configurar a tela do documento
              // que pode ser chamada v√°rias vezes se necess√°rio
              function configurarTelaDocumento() {
                console.log("Configurando tela do documento");
                
                // Verificar o tipo de URL retornada e ajustar para exibi√ß√£o em iframe
                let urlParaIframe = window.documentoGerado.url;
                
                // Se for URL do Google Docs, ajustar para incorpora√ß√£o
                if (urlParaIframe.includes('docs.google.com') && !urlParaIframe.includes('/preview')) {
                  urlParaIframe = urlParaIframe.replace('/edit', '/preview');
                  
                  // Garantir que seja uma URL de incorpora√ß√£o
                  if (urlParaIframe.includes('?')) {
                    urlParaIframe += '&embedded=true';
                  } else {
                    urlParaIframe += '?embedded=true';
                  }
                }
                
                // Preencher informa√ß√µes do documento
                document.getElementById('documentoNome').textContent = window.documentoGerado.nome;
                document.getElementById('documentoTipo').textContent = window.documentoGerado.tipo;
                
                // Data atual formatada
                const dataAtual = new Date();
                const dataFormatada = dataAtual.toLocaleDateString('pt-BR') + ' √†s ' + 
                                     dataAtual.getHours().toString().padStart(2, '0') + ':' +
                                     dataAtual.getMinutes().toString().padStart(2, '0');
                document.getElementById('documentoData').textContent = dataFormatada;
                
                // Preencher dados do cliente
                if (userData && userData.dados) {
                  document.getElementById('clienteNome').textContent = userData.dados.nome || '-';
                  document.getElementById('clienteCpf').textContent = userData.dados.cpf || '-';
                  document.getElementById('clienteEndereco').textContent = userData.dados.endereco || '-';
                }
                
                // Definir URL do iframe
                document.getElementById('documentoIframe').src = urlParaIframe;
                
                // CR√çTICO: Mudar a visibilidade dos containers diretamente
                document.getElementById('pessoaDadosContainer').style.display = 'none';
                document.getElementById('documentoGeradoContainer').style.display = 'block';
                
                // Atualizar status se houver mensagem espec√≠fica
                document.getElementById('statusDocumento').textContent = window.documentoGerado.mensagem;
                
                // Limpar e reconfigurar bot√µes para evitar m√∫ltiplos listeners
                const abrirNovaAbaBtn = document.getElementById('abrirNovaAbaBtn');
                const novoAbrirBtn = abrirNovaAbaBtn.cloneNode(true);
                abrirNovaAbaBtn.parentNode.replaceChild(novoAbrirBtn, abrirNovaAbaBtn);
                
                const voltarBtn = document.getElementById('voltarBtn');
                const novoVoltarBtn = voltarBtn.cloneNode(true);
                voltarBtn.parentNode.replaceChild(novoVoltarBtn, voltarBtn);
                
                const gerarAssinaturaBtn = document.getElementById('gerarAssinaturaBtn');
                const novoAssinarBtn = gerarAssinaturaBtn.cloneNode(true);
                gerarAssinaturaBtn.parentNode.replaceChild(novoAssinarBtn, gerarAssinaturaBtn);
                
                // Configurar o bot√£o para abrir em nova aba
                document.getElementById('abrirNovaAbaBtn').addEventListener('click', () => {
                  window.open(window.documentoGerado.url, '_blank');
                });
                
                // Configurar o bot√£o para voltar
                document.getElementById('voltarBtn').addEventListener('click', () => {
                  document.getElementById('documentoGeradoContainer').style.display = 'none';
                  routeBtns.forEach(b => b.classList.remove('active'));
                  document.getElementById('documentoIframe').src = 'about:blank';
                  // Limpar os dados do documento
                  window.documentoGerado = null;
                });
                
                // Configurar bot√£o de assinatura
                document.getElementById('gerarAssinaturaBtn').addEventListener('click', async () => {
                  try {
                    const assinaturaBtn = document.getElementById('gerarAssinaturaBtn');
                    assinaturaBtn.disabled = true;
                    assinaturaBtn.textContent = 'Processando...';
                    
                    // Criar payload com todos os dados necess√°rios
                    const payloadAssinatura = {
                      acao: 'assinatura_digital',
                      documento_url: window.documentoGerado.url,
                      documento_id: window.documentoGerado.documentId,
                      documento_nome: window.documentoGerado.nome,
                      documento_tipo: window.documentoGerado.tipo,
                      cliente: userData?.dados || {},
                      usuario_id: sessionStorage.getItem('userId') || null,
                      data_geracao: dataAtual.toISOString()
                    };
                    
                    console.log("Enviando para assinatura:", payloadAssinatura);
                    
                    // Enviar para webhook de assinatura
                    const assinaturaResponse = await fetch(n8nWebhooks.assinaturaDigital || 'https://app.floweasysetup.com.br/webhook/assinatura-digital', {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(payloadAssinatura)
                    });
                    
                    if (assinaturaResponse.ok) {
                      const assinaturaResult = await assinaturaResponse.json();
                      console.log("Resposta assinatura:", assinaturaResult);
                      
                      if (assinaturaResult.success) {
                        mostrarAviso('Assinatura Iniciada', assinaturaResult.mensagem || 'O processo de assinatura digital foi iniciado com sucesso!');
                        
                        // Se houver um link para o portal de assinatura, abrir
                        if (assinaturaResult.url_assinatura) {
                          window.open(assinaturaResult.url_assinatura, '_blank');
                        }
                      } else {
                        mostrarAviso('Erro', assinaturaResult.mensagem || 'N√£o foi poss√≠vel iniciar o processo de assinatura.');
                      }
                    } else {
                      mostrarAviso('Erro', 'Falha ao conectar com o servi√ßo de assinatura digital.');
                    }
                  } catch (error) {
                    console.error('Erro ao iniciar assinatura:', error);
                    mostrarAviso('Erro de Conex√£o', 'N√£o foi poss√≠vel conectar ao servi√ßo de assinatura digital. Verifique sua conex√£o.');
                  } finally {
                    // Restaurar bot√£o
                    document.getElementById('gerarAssinaturaBtn').disabled = false;
                    document.getElementById('gerarAssinaturaBtn').textContent = 'Gerar Assinatura Digital';
                  }
                });
                
                console.log("Tela do documento configurada com sucesso");
              }
              
              // Configurar a tela imediatamente
              configurarTelaDocumento();
              
              // Mostrar aviso de sucesso com garantia de passar para a tela do documento
              // ap√≥s o usu√°rio fechar o aviso
              mostrarAviso('Sucesso', `Documento gerado com sucesso! ${result.mensagem || ''}`, () => {
                // Verificar se a tela do documento est√° vis√≠vel ap√≥s fechar o aviso
                // Se n√£o estiver, configurar novamente
                console.log("Callback do aviso executado");
                setTimeout(() => {
                  if (document.getElementById('documentoGeradoContainer').style.display !== 'block') {
                    console.log("For√ßando exibi√ß√£o da tela do documento ap√≥s fechar o aviso");
                    configurarTelaDocumento();
                  }
                }, 100);
              });
              
            } else {
              mostrarAviso('Sucesso', 'Documento preparado com sucesso!');
            }
          } else {
            mostrarAviso('Erro', `Falha ao gerar o documento: ${result.message || 'Erro desconhecido'}`);
          }
        } catch (err) {
          confirmPopup.classList.remove('active');
          console.error('Erro ao gerar documento:', err);
          mostrarAviso('Erro de Conex√£o', 'Erro de rede ao gerar o documento. Verifique sua conex√£o.');
        } finally {
          // Restaurar bot√£o
          confirmYesBtn.disabled = false;
          confirmYesBtn.textContent = 'Sim';
        }
      });

      // Bot√£o de Nova Consulta
      novaPesquisaBtn.addEventListener('click', () => {
        pessoaDadosContainer.style.display = 'none';
        routeBtns.forEach(b => b.classList.remove('active'));
      });

      // Bot√£o "N√£o" do popup de confirma√ß√£o
      confirmNoBtn.addEventListener('click', () => {
        confirmPopup.classList.remove('active');
      });
      
      // Bot√£o "Preencher Documento"
      preencherDocumentoBtn.addEventListener('click', () => {
        // Mostrar popup de confirma√ß√£o
        confirmPopup.classList.add('active');
      });
      
      // Configurar o aviso personalizado
      const avisoPopup = document.getElementById('avisoPopup');
      const avisoOkBtn = document.getElementById('avisoOkBtn');
      const avisoTitulo = document.getElementById('avisoTitulo');
      const avisoMensagem = document.getElementById('avisoMensagem');
      
      // Fun√ß√£o para mostrar aviso personalizado
      function mostrarAviso(titulo, mensagem, callback) {
        avisoTitulo.textContent = titulo;
        avisoMensagem.textContent = mensagem;
        
        // Ajustar a cor do √≠cone com base no tipo de mensagem
        const icone = avisoPopup.querySelector('i');
        if (titulo.toLowerCase().includes('sucesso')) {
          icone.style.color = '#4caf50'; // Verde para sucesso
          icone.innerHTML = '&#10004;'; // √çcone de check
        } else if (titulo.toLowerCase().includes('erro')) {
          icone.style.color = '#e74c3c'; // Vermelho para erro
          icone.innerHTML = '&#9888;'; // √çcone de alerta
        } else if (titulo.toLowerCase().includes('aten√ß√£o')) {
          icone.style.color = '#f39c12'; // Amarelo para aten√ß√£o
          icone.innerHTML = '&#9888;'; // √çcone de alerta
        } else {
          icone.style.color = '#2196f3'; // Azul para informa√ß√£o
          icone.innerHTML = '&#8505;'; // √çcone de informa√ß√£o
        }
        
        // Criar ou substituir o listener para o bot√£o OK
        const novoBtn = avisoOkBtn.cloneNode(true);
        avisoOkBtn.parentNode.replaceChild(novoBtn, avisoOkBtn);
        
        novoBtn.addEventListener('click', function() {
          avisoPopup.classList.remove('active');
          if (typeof callback === 'function') {
            callback();
          }
        });
        
        // Mostrar o popup
        avisoPopup.classList.add('active');
      }
      
      // Fechar o aviso personalizado (removido pois agora est√° integrado na fun√ß√£o mostrarAviso)
      // avisoOkBtn.addEventListener('click', () => {
      //   avisoPopup.classList.remove('active');
      // });
    }

    // Fun√ß√µes de Login/Logout
    async function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      // URL do webhook de autentica√ß√£o no n8n
      const webhookUrl = 'https://app.floweasysetup.com.br/webhook/autenticar';

      // Desabilitar o bot√£o de login durante a autentica√ß√£o
      const loginBtn = document.querySelector('.login-btn');
      loginBtn.disabled = true;
      loginBtn.textContent = 'Entrando...';

      try {
        const response = await fetch(webhookUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            email, 
            password,
            acao: 'login'
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Armazenar informa√ß√µes do usu√°rio para uso posterior
          if (data.usuario && data.usuario.id) {
            sessionStorage.setItem('userId', data.usuario.id);
            sessionStorage.setItem('userName', data.usuario.nome);
            sessionStorage.setItem('userRole', data.usuario.cargo);
            // N√£o armazenar dados sens√≠veis como senhas
          }
          
          showSuccess();
        } else {
          showError();
        }
      } catch (error) {
        console.error('Erro no fetch:', error);
        // Modo de teste local - remover em produ√ß√£o
        if (email === 'demo@example.com' && password === '123456') {
          sessionStorage.setItem('userId', 'usuario-demo-id');
          sessionStorage.setItem('userName', 'Usu√°rio Demo');
          showSuccess();
        } else {
          showError();
        }
      } finally {
        // Restaurar o bot√£o de login
        loginBtn.disabled = false;
        loginBtn.textContent = 'Entrar';
      }
    }

    function showSuccess() {
      successMessage.style.display = 'block';
      errorMessage.style.display = 'none';
      
      // Atualizar as informa√ß√µes do usu√°rio
      updateUserInfo();
      
      setTimeout(() => {
        loginContainer.classList.add('hidden');
        menuContainer.classList.remove('hidden');
        document.body.classList.remove('login-bg');
        document.body.classList.add('menu-bg');
      }, 1500);
    }

    // Fun√ß√£o para atualizar as informa√ß√µes do usu√°rio no sidebar
    function updateUserInfo() {
      const userName = sessionStorage.getItem('userName') || 'Usu√°rio';
      const userRole = sessionStorage.getItem('userRole') || 'Usu√°rio';
      
      // Atualizar o nome e cargo do usu√°rio
      const userNameDisplay = document.getElementById('userNameDisplay');
      const userRoleDisplay = document.getElementById('userRoleDisplay');
      const userAvatar = document.getElementById('userAvatar');
      
      if (userNameDisplay) userNameDisplay.textContent = userName;
      if (userRoleDisplay) userRoleDisplay.textContent = userRole;
      
      // Adicionar a primeira letra do nome ao avatar
      if (userAvatar && userName && userName.length > 0) {
        userAvatar.textContent = userName.charAt(0).toUpperCase();
      }
    }

    function showError() {
      successMessage.style.display = 'none';
      errorMessage.style.display = 'block';
    }

    function handleLogout() {
      // Opcionalmente, enviar logout para o servidor
      fetch(n8nWebhooks.autenticacao, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          acao: 'logout',
          userId: sessionStorage.getItem('userId')
        })
      })
      .then(response => {
        if (!response.ok) {
          console.error('Erro ao fazer logout no servidor:', response.status);
        }
        return response.json();
      })
      .then(data => {
        console.log('Logout registrado com sucesso:', data);
      })
      .catch(error => console.error('Erro ao registrar logout:', error))
      .finally(() => {
        // Limpar dados da sess√£o
        sessionStorage.removeItem('userId');
        sessionStorage.removeItem('userName');
        sessionStorage.removeItem('userRole');
        
        // Reiniciar formul√°rio e mostrar tela de login
      document.getElementById('loginForm').reset();
      errorMessage.style.display = 'none';
      successMessage.style.display = 'none';
      loginContainer.classList.remove('hidden');
      menuContainer.classList.add('hidden');
      document.body.classList.remove('menu-bg');
      document.body.classList.add('login-bg');
      });
    }

    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.getElementById('logoutButton').addEventListener('click', handleLogout);

    // Inicializar o menu mobile
    setupMobileMenu();

    // Inicializar o controle de tema
    setupThemeToggle();

    // Fun√ß√£o para configurar a p√°gina de modelos
    function setupModelosLogic() {
      const uploadForm = document.getElementById('uploadModelForm');
      const modelNameInput = document.getElementById('modelName');
      const modelDescriptionInput = document.getElementById('modelDescription');
      const modelFileInput = document.getElementById('modelFile');
      const modelCategoryInput = document.getElementById('modelCategory');
      const uploadModelBtn = document.getElementById('uploadModelBtn');
      const modelSearchInput = document.getElementById('modelSearch');
      const filterCategorySelect = document.getElementById('filterCategory');
      
      // Verificar se os elementos foram encontrados (estamos na p√°gina correta)
      if (!uploadForm || !modelNameInput || !modelFileInput) return;
      
      // Carregar lista de modelos existentes
      loadModels();
      
      // Configurar evento de busca e filtro
      if (modelSearchInput) {
        modelSearchInput.addEventListener('input', function() {
          loadModels(this.value, filterCategorySelect.value);
        });
      }
      
      if (filterCategorySelect) {
        filterCategorySelect.addEventListener('change', function() {
          loadModels(modelSearchInput.value, this.value);
        });
      }
      
      // Configurar evento de envio do formul√°rio
      uploadForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Validar arquivo
        const fileInput = modelFileInput;
        if (fileInput.files.length === 0) {
          alert('Por favor, selecione um arquivo DOC/DOCX.');
          return;
        }
        
        const file = fileInput.files[0];
        
        // Verificar tipo do arquivo
        const validTypes = ['application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
        if (!validTypes.includes(file.type)) {
          alert('Por favor, selecione um arquivo DOC ou DOCX v√°lido.');
          return;
        }
        
        // Verificar tamanho (m√°ximo 10MB)
        if (file.size > 10 * 1024 * 1024) {
          alert('O arquivo √© muito grande. O tamanho m√°ximo √© 10MB.');
          return;
        }
        
        // Mostrar indicador de carregamento
        const loadingElement = document.createElement('div');
        loadingElement.className = 'loading-overlay';
        loadingElement.innerHTML = '<div class="loading-spinner"></div><p>Enviando modelo...</p>';
        document.body.appendChild(loadingElement);
        
        try {
          // Preparar dados para envio (FormData para upload de arquivo)
          const formData = new FormData();
          formData.append('file', file);
          formData.append('nome', modelNameInput.value);
          formData.append('descricao', modelDescriptionInput.value || '');
          formData.append('categoria', modelCategoryInput.value);
          formData.append('usuario_id', sessionStorage.getItem('userId') || '');
          formData.append('acao', 'upload_modelo');
          formData.append('destino', 'google_drive'); // Enviar para o Google Drive
          
          // Mostrar mensagem de upload para o Google Drive
          loadingElement.innerHTML = '<div class="loading-spinner"></div><p>Enviando modelo para o Google Drive...</p>';
          
          // Enviar para o webhook
          const response = await fetch(n8nWebhooks.modelos, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          // Remover indicador de carregamento
          document.body.removeChild(loadingElement);
          
          if (response.ok && result.success) {
            showNotification('success', 'Modelo Enviado', `O modelo "${modelNameInput.value}" foi enviado com sucesso para o Google Drive!`);
            
            // Limpar formul√°rio
            uploadForm.reset();
            
            // Recarregar lista de modelos
            loadModels();
          } else {
            showNotification('error', 'Erro no Envio', `N√£o foi poss√≠vel enviar o modelo: ${result.message || 'Erro desconhecido'}`);
          }
        } catch (error) {
          // Remover indicador de carregamento
          document.body.removeChild(loadingElement);
          console.error('Erro ao enviar modelo:', error);
          showNotification('error', 'Erro de Conex√£o', 'Ocorreu um erro ao tentar enviar o modelo. Verifique sua conex√£o.');
        }
      });
    }
    
    // Fun√ß√µes globais para a√ß√µes nos modelos
    function viewModel(modelId) {
      if (!modelId) return;
      
      // Mostrar indicador de carregamento
      const loadingElement = document.createElement('div');
      loadingElement.className = 'loading-overlay';
      loadingElement.innerHTML = '<div class="loading-spinner"></div><p>Preparando documento para visualiza√ß√£o...</p>';
      document.body.appendChild(loadingElement);
      
      // Enviar requisi√ß√£o para preparar a visualiza√ß√£o
      fetch(n8nWebhooks.modelos, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          acao: 'visualizar',
          id: modelId,
          usuario_id: sessionStorage.getItem('userId') || ''
        })
      })
      .then(response => response.json())
      .then(result => {
        // Remover indicador de carregamento
        document.body.removeChild(loadingElement);
        
        // Verificar se o resultado √© um objeto com URL ou um modelo completo
        if (result.success && result.url) {
          // Formato: { success: true, url: "..." }
          showNotification('info', 'Abrindo Modelo', 'O documento ser√° aberto em uma nova aba.');
          window.open(result.url, '_blank');
        } else if (Array.isArray(result) && result.length > 0 && result[0].arquivo_url) {
          // Formato: [{ ..., arquivo_url: "..." }]
          showNotification('info', 'Abrindo Modelo', 'O documento ser√° aberto em uma nova aba.');
          window.open(result[0].arquivo_url, '_blank');
        } else if (result.arquivo_url) {
          // Formato: { ..., arquivo_url: "..." }
          showNotification('info', 'Abrindo Modelo', 'O documento ser√° aberto em uma nova aba.');
          window.open(result.arquivo_url, '_blank');
        } else {
          showNotification('error', 'Erro ao Visualizar', `N√£o foi poss√≠vel abrir o documento: ${result.message || 'Erro desconhecido'}`);
        }
      })
      .catch(error => {
        // Remover indicador de carregamento
        document.body.removeChild(loadingElement);
        console.error('Erro ao preparar visualiza√ß√£o:', error);
        showNotification('error', 'Erro de Conex√£o', 'Ocorreu um erro ao tentar preparar o documento para visualiza√ß√£o.');
      });
    }
    
    function deleteModel(modelId) {
      if (!modelId) return;
      
      // Criar modal de confirma√ß√£o personalizado
      const confirmModal = document.createElement('div');
      confirmModal.className = 'custom-modal';
      confirmModal.innerHTML = `
        <div class="custom-modal-content">
          <div class="custom-modal-header">
            <h3>Confirmar exclus√£o</h3>
            <span class="custom-modal-close">&times;</span>
          </div>
          <div class="custom-modal-body">
            <p>Tem certeza que deseja excluir este modelo?</p>
            <p class="warning-text">Esta a√ß√£o n√£o pode ser desfeita.</p>
          </div>
          <div class="custom-modal-footer">
            <button class="btn-cancel">Cancelar</button>
            <button class="btn-confirm">Sim, excluir</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(confirmModal);
      
      // Mostrar modal
      setTimeout(() => confirmModal.classList.add('active'), 10);
      
      // Configurar eventos
      const closeBtn = confirmModal.querySelector('.custom-modal-close');
      const cancelBtn = confirmModal.querySelector('.btn-cancel');
      const confirmBtn = confirmModal.querySelector('.btn-confirm');
      
      // Fun√ß√£o para fechar o modal
      const closeModal = () => {
        confirmModal.classList.remove('active');
        setTimeout(() => confirmModal.remove(), 300);
      };
      
      // Configurar eventos de fechar
      closeBtn.addEventListener('click', closeModal);
      cancelBtn.addEventListener('click', closeModal);
      
      // Ao confirmar exclus√£o
      confirmBtn.addEventListener('click', () => {
        closeModal();
        
        // Mostrar indicador de carregamento
        const loadingElement = document.createElement('div');
        loadingElement.className = 'loading-overlay';
        loadingElement.innerHTML = '<div class="loading-spinner"></div><p>Excluindo modelo...</p>';
        document.body.appendChild(loadingElement);
        
        // Enviar solicita√ß√£o de exclus√£o
        fetch(n8nWebhooks.modelos, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            acao: 'excluir_modelo',
            id: modelId,
            usuario_id: sessionStorage.getItem('userId') || ''
          })
        })
        .then(response => response.json())
        .then(result => {
          // Remover indicador de carregamento
          document.body.removeChild(loadingElement);
          
          if (result.success) {
            showNotification('success', 'Modelo Exclu√≠do', 'O modelo foi exclu√≠do com sucesso!');
            
            // Recarregar lista de modelos
            if (document.getElementById('modelsList')) {
              const modelSearchInput = document.getElementById('modelSearch');
              const filterCategorySelect = document.getElementById('filterCategory');
              loadModels(
                modelSearchInput ? modelSearchInput.value : '', 
                filterCategorySelect ? filterCategorySelect.value : ''
              );
            }
          } else {
            showNotification('error', 'Erro na Exclus√£o', `N√£o foi poss√≠vel excluir o modelo: ${result.message || 'Erro desconhecido'}`);
          }
        })
        .catch(error => {
          // Remover indicador de carregamento
          document.body.removeChild(loadingElement);
          console.error('Erro ao excluir modelo:', error);
          showNotification('error', 'Erro de Conex√£o', 'Ocorreu um erro ao tentar excluir o modelo. Verifique sua conex√£o.');
        });
      });
    }
    
    // Fun√ß√£o para carregar a lista de modelos - vers√£o global para poder ser chamada ap√≥s dele√ß√£o
    async function loadModels(search = '', category = '') {
      const modelsListContainer = document.getElementById('modelsList');
      if (!modelsListContainer) return;
      
      // Mostrar indicador de carregamento
      modelsListContainer.innerHTML = '<div class="models-loading"><p>Carregando modelos...</p></div>';
      
      try {
        // Usando POST em vez de GET para consist√™ncia
        const response = await fetch(n8nWebhooks.modelos, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            acao: 'listar_modelos',
            busca: search || '',
            categoria: category || '',
            usuario_id: sessionStorage.getItem('userId') || ''
          })
        });
        
        // Processar a resposta
        const result = await response.json();
        
        // Verificar se a resposta √© um array (formato direto) ou tem um wrapper
        const models = Array.isArray(result) ? result : (result.success && result.modelos ? result.modelos : []);
        
        if (response.ok && models.length > 0) {
          // Exibir modelos
          let modelHtml = '';
          models.forEach(model => {
            const createdDate = new Date(model.created_at).toLocaleDateString('pt-BR');
            
            modelHtml += `
              <div class="model-card" data-id="${model.id}">
                <div class="model-title">${model.nome}</div>
                <div class="model-description">${model.descricao || 'Sem descri√ß√£o'}</div>
                <div class="model-meta">
                  <span>Categoria: ${model.categoria}</span>
                  <span>Data: ${createdDate}</span>
                </div>
                <div class="model-actions">
                  <button class="download" onclick="viewModel('${model.id}')">Visualizar</button>
                  <button onclick="deleteModel('${model.id}')">Excluir</button>
                </div>
              </div>
            `;
          });
          
          modelsListContainer.innerHTML = modelHtml;
        } else if (response.ok && models.length === 0) {
          // Sem modelos encontrados
          modelsListContainer.innerHTML = `
            <div class="models-empty">
              <i>üìÑ</i>
              <p>Nenhum modelo encontrado</p>
              <p>Comece fazendo upload de um novo modelo.</p>
            </div>
          `;
        } else {
          // Erro na resposta
          modelsListContainer.innerHTML = `
            <div class="models-error">
              <i>‚ö†Ô∏è</i>
              <p>Erro ao carregar modelos</p>
              <p>${result.message || 'N√£o foi poss√≠vel conectar ao servidor'}</p>
              <button class="retry-btn" onclick="loadModels('${search}', '${category}')">Tentar Novamente</button>
            </div>
          `;
          console.error('Erro ao carregar modelos:', result.message);
        }
      } catch (error) {
        console.error('Erro ao carregar modelos:', error);
        modelsListContainer.innerHTML = `
          <div class="models-error">
            <i>‚ö†Ô∏è</i>
            <p>Erro ao carregar modelos</p>
            <p>Verifique sua conex√£o com a internet</p>
            <button class="retry-btn" onclick="loadModels('${search}', '${category}')">Tentar Novamente</button>
          </div>
        `;
      }
    }

    // Fun√ß√£o para mostrar notifica√ß√µes
    function showNotification(type, title, message, duration = 5000) {
      // Remover notifica√ß√µes existentes
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notification => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 400);
      });
      
      // Criar elementos da notifica√ß√£o
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      let iconContent = '';
      switch (type) {
        case 'success':
          iconContent = '‚úì';
          break;
        case 'error':
          iconContent = '‚úï';
          break;
        case 'warning':
          iconContent = '!';
          break;
        case 'info':
          iconContent = 'i';
          break;
      }
      
      notification.innerHTML = `
        <div class="notification-icon">${iconContent}</div>
        <div class="notification-content">
          <div class="notification-title">${title}</div>
          <div class="notification-message">${message}</div>
        </div>
        <div class="notification-close">‚úï</div>
        <div class="notification-progress">
          <div class="notification-progress-bar"></div>
        </div>
      `;
      
      // Adicionar ao DOM
      document.body.appendChild(notification);
      
      // For√ßar reflow para iniciar a anima√ß√£o corretamente
      notification.offsetHeight;
      
      // Mostrar notifica√ß√£o
      setTimeout(() => notification.classList.add('show'), 10);
      
      // Configurar evento de fechar
      const closeBtn = notification.querySelector('.notification-close');
      closeBtn.addEventListener('click', () => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 400);
      });
      
      // Fechar automaticamente ap√≥s a dura√ß√£o especificada
      if (duration > 0) {
        setTimeout(() => {
          if (document.body.contains(notification)) {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 400);
          }
        }, duration);
      }
      
      return notification;
    }

    function mostrarAviso(tipo, mensagem, callback) {
        // Remover qualquer aviso anterior
        const avisoAnterior = document.querySelector('.aviso-popup');
        if (avisoAnterior) {
            document.body.removeChild(avisoAnterior);
        }

        // Criar o container do aviso
        const avisoContainer = document.createElement('div');
        avisoContainer.className = 'aviso-popup';
        avisoContainer.style.position = 'fixed';
        avisoContainer.style.top = '0';
        avisoContainer.style.left = '0';
        avisoContainer.style.width = '100%';
        avisoContainer.style.height = '100%';
        avisoContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        avisoContainer.style.display = 'flex';
        avisoContainer.style.justifyContent = 'center';
        avisoContainer.style.alignItems = 'center';
        avisoContainer.style.zIndex = '9999';

        // Criar o conte√∫do do aviso
        const avisoContent = document.createElement('div');
        avisoContent.style.backgroundColor = 'white';
        avisoContent.style.padding = '20px';
        avisoContent.style.borderRadius = '5px';
        avisoContent.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.1)';
        avisoContent.style.textAlign = 'center';
        avisoContent.style.maxWidth = '500px';
        avisoContent.style.width = '90%';

        // √çcone
        const avisoIcone = document.createElement('div');
        if (tipo === 'sucesso') {
            avisoIcone.innerHTML = '<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="32" fill="#4CAF50" fill-opacity="0.1"/><path d="M32 2C15.432 2 2 15.432 2 32C2 48.568 15.432 62 32 62C48.568 62 62 48.568 62 32C62 15.432 48.568 2 32 2ZM32 56C18.767 56 8 45.233 8 32C8 18.767 18.767 8 32 8C45.233 8 56 18.767 56 32C56 45.233 45.233 56 32 56Z" fill="#4CAF50"/><path d="M44 24L28 40L20 32" stroke="#4CAF50" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        } else if (tipo === 'erro') {
            avisoIcone.innerHTML = '<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="32" fill="#F44336" fill-opacity="0.1"/><path d="M32 2C15.432 2 2 15.432 2 32C2 48.568 15.432 62 32 62C48.568 62 62 48.568 62 32C62 15.432 48.568 2 32 2ZM32 56C18.767 56 8 45.233 8 32C8 18.767 18.767 8 32 8C45.233 8 56 18.767 56 32C56 45.233 45.233 56 32 56Z" fill="#F44336"/><path d="M42 22L22 42" stroke="#F44336" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 22L42 42" stroke="#F44336" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        } else {
            avisoIcone.innerHTML = '<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="32" fill="#2196F3" fill-opacity="0.1"/><path d="M32 2C15.432 2 2 15.432 2 32C2 48.568 15.432 62 32 62C48.568 62 62 48.568 62 32C62 15.432 48.568 2 32 2ZM32 56C18.767 56 8 45.233 8 32C8 18.767 18.767 8 32 8C45.233 8 56 18.767 56 32C56 45.233 45.233 56 32 56Z" fill="#2196F3"/><path d="M32 20V32" stroke="#2196F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><circle cx="32" cy="44" r="2" fill="#2196F3"/></svg>';
        }
        avisoContent.appendChild(avisoIcone);

        // T√≠tulo do aviso
        const avisoTitulo = document.createElement('h3');
        avisoTitulo.textContent = tipo.charAt(0).toUpperCase() + tipo.slice(1);
        avisoTitulo.style.margin = '10px 0';
        avisoContent.appendChild(avisoTitulo);

        // Mensagem do aviso
        const avisoMensagem = document.createElement('p');
        avisoMensagem.textContent = mensagem;
        avisoMensagem.style.marginBottom = '20px';
        avisoContent.appendChild(avisoMensagem);

        // Bot√£o OK
        const btnOK = document.createElement('button');
        btnOK.textContent = 'OK';
        btnOK.style.padding = '10px 20px';
        btnOK.style.backgroundColor = '#2196F3';
        btnOK.style.color = 'white';
        btnOK.style.border = 'none';
        btnOK.style.borderRadius = '4px';
        btnOK.style.cursor = 'pointer';
        
        // MODIFICA√á√ÉO AQUI: Ao clicar em OK, for√ßamos a atualiza√ß√£o da interface
        btnOK.addEventListener('click', function() {
            console.log("Bot√£o OK clicado - fechando popup e executando callback");
            
            // Remover o popup
            document.body.removeChild(avisoContainer);
            
            // HACK: For√ßar substitui√ß√£o do conte√∫do diretamente no HTML da p√°gina
            if (window.documentoGerado) {
                // Selecionar o container principal
                const mainContainer = document.querySelector('.container.mt-5');
                if (mainContainer) {
                    console.log("TRANSFORMANDO INTERFACE...");
                    
                    // Esconder a se√ß√£o de dados do usu√°rio
                    mainContainer.style.display = 'none';
                    
                    // Criar um novo container para o documento
                    const novoContainer = document.createElement('div');
                    novoContainer.className = 'container mt-5';
                    novoContainer.id = 'documento-container';
                    
                    // Definir HTML do novo container com layout da tela do documento
                    novoContainer.innerHTML = `
                        <div class="row">
                            <div class="col-12">
                                <h2 class="text-primary">Documento Gerado</h2>
                                <p class="text-success">Documento gerado com sucesso!</p>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div id="documento-preview-container" style="width: 100%; height: 700px; border: 1px solid #e0e0e0; border-radius: 5px; overflow: hidden;">
                                    <iframe id="documento-iframe" src="${window.documentoGerado.url_documento}" style="width: 100%; height: 100%; border: none;"></iframe>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div style="background-color: #f5f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #0c3c82;">
                                    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                                        <div style="flex: 1; min-width: 250px;">
                                            <h3 style="font-size: 16px; margin-bottom: 10px; color: #0c3c82;">Detalhes do Documento</h3>
                                            <p><strong>Nome do arquivo:</strong> <span id="documento-nome">${window.documentoGerado.nome_documento || 'Documento Gerado'}</span></p>
                                            <p><strong>Tipo:</strong> <span>Termos Gerais</span></p>
                                            <p><strong>Gerado em:</strong> <span>${new Date().toLocaleDateString('pt-BR')}</span></p>
                                        </div>
                                        <div style="flex: 1; min-width: 250px;">
                                            <h3 style="font-size: 16px; margin-bottom: 10px; color: #0c3c82;">Dados do Cliente</h3>
                                            <p><strong>Nome:</strong> <span>${document.getElementById('nome').value}</span></p>
                                            <p><strong>CPF:</strong> <span>${document.getElementById('cpf').value}</span></p>
                                            <p><strong>Endere√ßo:</strong> <span>${document.getElementById('endereco').value}</span></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <button id="btn-assinatura-digital" class="btn btn-success btn-lg">
                                        <i class="fas fa-signature"></i> Gerar Assinatura Digital
                                    </button>
                                    <button id="btn-abrir-documento" class="btn btn-primary">
                                        <i class="fas fa-external-link-alt"></i> Abrir em Nova Aba
                                    </button>
                                    <button id="btn-atualizar-documento" class="btn btn-warning" style="background-color: #ff9800; color: white; font-weight: bold; margin: 8px 0; position: relative; overflow: hidden;">
                                        <i class="fas fa-sync-alt"></i> Atualizar Arquivo
                                        <span style="position: absolute; width: 100%; height: 100%; top: 0; left: -100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); animation: shine 2s infinite;"></span>
                                    </button>
                                    <button id="btn-voltar" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left"></i> Voltar
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Inserir o novo container logo ap√≥s o container atual
                    if (mainContainer.parentNode) {
                        mainContainer.parentNode.insertBefore(novoContainer, mainContainer.nextSibling);
                    } else {
                        // Se n√£o conseguir inserir depois, adicionar ao body
                        document.body.appendChild(novoContainer);
                    }
                    
                    // Configurar eventos dos bot√µes
                    setTimeout(() => {
                        // Bot√£o de assinatura digital
                        const btnAssinatura = document.getElementById('btn-assinatura-digital');
                        if (btnAssinatura) {
                            btnAssinatura.addEventListener('click', function() {
                                this.disabled = true;
                                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
                                
                                setTimeout(() => {
                                    this.disabled = false;
                                    this.innerHTML = 'Gerar Assinatura Digital';
                                    mostrarAviso('sucesso', 'Solicita√ß√£o de assinatura digital enviada com sucesso!');
                                }, 1500);
                            });
                        }
                        
                        // Bot√£o abrir em nova aba
                        const btnAbrir = document.getElementById('btn-abrir-documento');
                        if (btnAbrir) {
                            btnAbrir.addEventListener('click', function() {
                                window.open(window.documentoGerado.url_documento, '_blank');
                            });
                        }
                        
                        // Bot√£o atualizar documento
                        const btnAtualizar = document.getElementById('btn-atualizar-documento');
                        if (btnAtualizar) {
                            btnAtualizar.addEventListener('click', function() {
                                console.log("Bot√£o de atualizar documento clicado");
                                // Mostrar feedback visual no bot√£o
                                const btnAtualizar = this;
                                const originalText = btnAtualizar.innerHTML;
                                btnAtualizar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
                                btnAtualizar.disabled = true;
                                
                                // Chamar a fun√ß√£o de atualiza√ß√£o
                                const iframe = document.getElementById('documento-iframe');
                                if (iframe) {
                                    // Fun√ß√£o para quando o iframe terminar de carregar
                                    iframe.onload = function() {
                                        console.log("Iframe recarregado com sucesso");
                                        setTimeout(() => {
                                            btnAtualizar.innerHTML = originalText;
                                            btnAtualizar.disabled = false;
                                            mostrarAviso('sucesso', 'Documento atualizado com sucesso!');
                                        }, 500);
                                    };
                                    
                                    // Adiciona um timestamp para for√ßar recarga sem cache
                                    let currentSrc = iframe.src;
                                    
                                    // Remover timestamp anterior se existir
                                    if (currentSrc.includes('t=')) {
                                        currentSrc = currentSrc.replace(/[&?]t=\d+/, '');
                                    }
                                    
                                    // Adicionar novo timestamp
                                    const timestamp = new Date().getTime();
                                    const newSrc = currentSrc.includes('?') ? 
                                        `${currentSrc}&t=${timestamp}` : 
                                        `${currentSrc}?t=${timestamp}`;
                                    
                                    // Atualizar o iframe
                                    iframe.src = newSrc;
                                    console.log("Iframe atualizado com timestamp");
                                } else {
                                    mostrarAviso('erro', 'N√£o foi poss√≠vel encontrar o documento para atualizar');
                                    btnAtualizar.innerHTML = originalText;
                                    btnAtualizar.disabled = false;
                                }
                            });
                        }
                        
                        // Bot√£o voltar
                        const btnVoltar = document.getElementById('btn-voltar');
                        if (btnVoltar) {
                            btnVoltar.addEventListener('click', function() {
                                // Mostrar novamente a se√ß√£o de dados
                                mainContainer.style.display = 'block';
                                // Remover o container do documento
                                if (novoContainer.parentNode) {
                                    novoContainer.parentNode.removeChild(novoContainer);
                                }
                                // Limpar dados do documento
                                window.documentoGerado = null;
                            });
                        }
                    }, 100);
                }
            }
            
            // Executar o callback original se fornecido
            if (typeof callback === 'function') {
                callback();
            }
        });
        
        avisoContent.appendChild(btnOK);
        avisoContainer.appendChild(avisoContent);
        document.body.appendChild(avisoContainer);
    }

    function fecharConfirmacao() {
        const confirmacaoPopup = document.getElementById('confirmacao-popup');
        if (confirmacaoPopup) {
            confirmacaoPopup.style.display = 'none';
        }
    }

    // Vari√°vel global para armazenar os dados do documento gerado
    window.documentoGerado = null;

    // Fun√ß√£o para renderizar a tela do documento (substitui o conte√∫do principal)
    function renderizarTelaDocumento(dados) {
        console.log("Renderizando tela do documento com os dados:", dados);
        
        // Encontrar o container principal da aplica√ß√£o
        const mainContainer = document.querySelector('.container.mt-5');
        if (!mainContainer) {
            console.error("Container principal n√£o encontrado!");
            return false;
        }
        
        // Salvar a refer√™ncia do container original para poder voltar depois
        if (!window.containerOriginal) {
            window.containerOriginal = mainContainer.innerHTML;
        }
        
        // Preparar a URL do documento para garantir edi√ß√£o
        let docUrl = dados.url_documento;
        
        // For√ßar URL de edi√ß√£o (remover par√¢metros existentes e adicionar nossos pr√≥prios)
        if (docUrl.includes('/edit')) {
            // Remover par√¢metros existentes se houver
            docUrl = docUrl.split('?')[0];
            
            // Google Docs espec√≠fico para edi√ß√£o embutida
            docUrl = docUrl + '?usp=sharing&widget=true&headers=false';
        }
        
        console.log("URL do documento para edi√ß√£o:", docUrl);
        
        // SUBSTITUIR COMPLETAMENTE o conte√∫do do container principal
        mainContainer.innerHTML = `
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="text-primary">Documento Gerado</h2>
                    <p class="text-success">Documento gerado com sucesso! <strong>Clique no documento abaixo para editar diretamente.</strong></p>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Editor de Documento</h5>
                            <small class="text-light">Clique dentro do documento para editar</small>
                        </div>
                        <div class="card-body p-0">
                            <iframe 
                                id="documento-iframe" 
                                src="${docUrl}" 
                                style="width:100%; height:700px; border:none;" 
                                frameborder="0" 
                                allowfullscreen="true" 
                                mozallowfullscreen="true" 
                                webkitallowfullscreen="true"
                                allow="clipboard-write; clipboard-read; autoplay; camera; microphone; display-capture"
                            ></iframe>
                        </div>
                    </div>
                    
                    <!-- Bot√£o alternativo para editar direto no Google Docs -->
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-info-circle"></i> 
                        Se n√£o conseguir editar diretamente acima, 
                        <a href="${dados.url_documento}" target="_blank" class="alert-link">clique aqui para editar no Google Docs</a>.
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Detalhes do Documento</h5>
                        </div>
                        <div class="card-body">
                            <div style="display: flex; flex-direction: column; gap: 15px;">
                                <div>
                                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #0c3c82;">Detalhes do Documento</h3>
                                    <p><strong>Nome do arquivo:</strong> <span>${dados.nome_documento || "Documento sem nome"}</span></p>
                                    <p><strong>Tipo:</strong> <span>${dados.tipo_documento || "Documento padr√£o"}</span></p>
                                    <p><strong>Gerado em:</strong> <span>${new Date().toLocaleString('pt-BR')}</span></p>
                                </div>
                                <div>
                                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #0c3c82;">Dados do Cliente</h3>
                                    <p><strong>Nome:</strong> <span>${document.getElementById('nome').value}</span></p>
                                    <p><strong>CPF:</strong> <span>${document.getElementById('cpf').value}</span></p>
                                    <p><strong>Endere√ßo:</strong> <span>${document.getElementById('endereco').value}</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <button id="btn-assinatura-digital" class="btn btn-success" style="flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            <i class="fas fa-signature"></i> Gerar Assinatura
                        </button>
                        <button id="btn-atualizar-documento" class="btn btn-warning" style="flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; background-color: #ff9800; color: white; font-weight: bold;">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                        <button id="btn-imprimir-doc" class="btn btn-info" style="flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; background-color: #2196F3; color: white; font-weight: bold;">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                        <button id="btn-abrir-documento" class="btn btn-primary" style="flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            <i class="fas fa-external-link-alt"></i> Abrir
                        </button>
                        <button id="btn-voltar" class="btn btn-secondary" style="flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // Configurar os listeners dos bot√µes
        document.getElementById('btn-assinatura-digital').addEventListener('click', function() {
            console.log("Bot√£o de assinatura digital clicado");
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
            
            // Construir o payload para o webhook de assinatura digital
            const dadosAssinatura = {
                action: "assinatura_digital",
                document_url: dados.url_documento,
                document_id: dados.documentId || "",
                nome_documento: dados.nome_documento || "Documento Gerado",
                tipo_documento: "Google Document",
                cliente: {
                    nome: document.getElementById('nome').value,
                    cpf: document.getElementById('cpf').value,
                    endereco: document.getElementById('endereco').value,
                    email: document.getElementById('email').value,
                    telefone: document.getElementById('telefone').value
                },
                user_id: "atual", // Substituir pelo ID do usu√°rio logado
                data_geracao: new Date().toISOString()
            };
            
            console.log("Enviando dados para assinatura digital:", dadosAssinatura);
            
            // Simular o envio para o webhook
            setTimeout(() => {
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-signature"></i> Gerar Assinatura Digital';
                mostrarAviso('sucesso', 'Solicita√ß√£o de assinatura digital enviada com sucesso!');
            }, 1500);
        });
        
        document.getElementById('btn-abrir-documento').addEventListener('click', function() {
            console.log("Abrindo documento em nova aba para edi√ß√£o:", dados.url_documento);
            window.open(dados.url_documento, '_blank');
        });
        
        document.getElementById('btn-atualizar-documento').addEventListener('click', function() {
            console.log("Bot√£o de atualizar documento clicado");
            // Mostrar feedback visual no bot√£o
            const btnAtualizar = this;
            const originalText = btnAtualizar.innerHTML;
            btnAtualizar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
            btnAtualizar.disabled = true;
            
            // Chamar a fun√ß√£o de atualiza√ß√£o
            const iframe = document.getElementById('documento-iframe');
            if (iframe) {
                // Fun√ß√£o para quando o iframe terminar de carregar
                iframe.onload = function() {
                    console.log("Iframe recarregado com sucesso");
                    setTimeout(() => {
                        btnAtualizar.innerHTML = originalText;
                        btnAtualizar.disabled = false;
                        mostrarAviso('sucesso', 'Documento atualizado com sucesso!');
                    }, 500);
                };
                
                // Adiciona um timestamp para for√ßar recarga sem cache
                let currentSrc = iframe.src;
                
                // Remover timestamp anterior se existir
                if (currentSrc.includes('t=')) {
                    currentSrc = currentSrc.replace(/[&?]t=\d+/, '');
                }
                
                // Adicionar novo timestamp
                const timestamp = new Date().getTime();
                const newSrc = currentSrc.includes('?') ? 
                    `${currentSrc}&t=${timestamp}` : 
                    `${currentSrc}?t=${timestamp}`;
                
                // Atualizar o iframe
                iframe.src = newSrc;
                console.log("Iframe atualizado com timestamp");
            } else {
                mostrarAviso('erro', 'N√£o foi poss√≠vel encontrar o documento para atualizar');
                btnAtualizar.innerHTML = originalText;
                btnAtualizar.disabled = false;
            }
        });
        
        document.getElementById('btn-voltar').addEventListener('click', function() {
            console.log("Voltando para a tela de dados pessoais");
            // Restaurar o conte√∫do original
            if (window.containerOriginal) {
                mainContainer.innerHTML = window.containerOriginal;
                // Reconfigurar os eventos originais
                configurarEventosOriginais();
            }
            // Limpar dados do documento
            window.documentoGerado = null;
        });
        
        // Tentar alternativas de edi√ß√£o se o iframe normal n√£o funcionar
        const verificarEdicao = () => {
            console.log("Verificando capacidade de edi√ß√£o do iframe");
            
            // Verificar se ap√≥s 5 segundos o usu√°rio clicou em abrir em nova aba
            // Se sim, mostrar um aviso sugerindo editar em nova aba
            setTimeout(() => {
                const iframe = document.getElementById('documento-iframe');
                if (iframe) {
                    console.log("Adicionando atalho para edi√ß√£o");
                    // Adicionar bot√£o de edi√ß√£o r√°pida sobre o iframe
                    const editButtonContainer = document.createElement('div');
                    editButtonContainer.style.position = 'absolute';
                    editButtonContainer.style.top = '50px';
                    editButtonContainer.style.left = '20px';
                    editButtonContainer.style.zIndex = '100';
                    
                    const editButton = document.createElement('button');
                    editButton.className = 'btn btn-warning';
                    editButton.innerHTML = '<i class="fas fa-edit"></i> Ativar Edi√ß√£o';
                    editButton.onclick = function() {
                        window.open(dados.url_documento, '_blank');
                        this.parentNode.style.display = 'none';
                    };
                    
                    editButtonContainer.appendChild(editButton);
                    iframe.parentNode.style.position = 'relative';
                    iframe.parentNode.appendChild(editButtonContainer);
                }
            }, 5000);
        };
        
        // Chamar verifica√ß√£o
        verificarEdicao();
        
        return true;
    }

    // Fun√ß√£o para configurar novamente os eventos originais ap√≥s voltar
    function configurarEventosOriginais() {
        // Reconfigurar o bot√£o de confirmar (preenchimento de documento)
        const btnConfirmar = document.getElementById('confirmar-btn');
        if (btnConfirmar) {
            // Remover qualquer evento existente
            btnConfirmar.replaceWith(btnConfirmar.cloneNode(true));
            // Adicionar o evento novamente
            document.getElementById('confirmar-btn').addEventListener('click', gerarDocumento);
        }
        
        // Reconfigurar o bot√£o de preencher documento
        const btnPreencher = document.getElementById('preencher-btn');
        if (btnPreencher) {
            btnPreencher.replaceWith(btnPreencher.cloneNode(true));
            document.getElementById('preencher-btn').addEventListener('click', function() {
                document.getElementById('confirmacao-popup').style.display = 'flex';
            });
        }
    }

    // Fun√ß√£o principal para gerar o documento
    function gerarDocumento() {
        const loadingEl = document.createElement('div');
        loadingEl.innerHTML = '<div class="spinner-border text-light" role="status"><span class="visually-hidden">Carregando...</span></div> Processando...';
        this.innerHTML = '';
        this.appendChild(loadingEl);
        this.disabled = true;
        
        const nome = document.getElementById('nome').value;
        const cpf = document.getElementById('cpf').value;
        const dataNascimento = document.getElementById('data-nascimento').value;
        const endereco = document.getElementById('endereco').value;
        const telefone = document.getElementById('telefone').value;
        const email = document.getElementById('email').value;

        // Construir payload para enviar ao webhook
        const payload = {
            nome,
            cpf,
            data_nascimento: dataNascimento,
            endereco,
            telefone,
            email,
            tipo_documento: "Termos Gerais"
        };

        console.log("Enviando dados para gera√ß√£o de documento:", payload);

        // Simula√ß√£o da chamada para o webhook
        setTimeout(() => {
            const resposta = {
                success: true,
                url_documento: "https://docs.google.com/document/d/1l7z5zraOw4kKwA9xCdo7jTHS_3fovsP0lkA8hlq9hI8/edit",
                documentId: "1l7z5zraOw4kKwA9xCdo7jTHS_3fovsP0lkA8hlq9hI8",
                nome_documento: "Contrato de Termos Gerais - " + nome,
                mensagem: "Documento gerado com sucesso!"
            };
            
            console.log("Resposta recebida do servidor:", resposta);
            
            // Armazenar os dados do documento para uso posterior
            window.documentoGerado = resposta;
            
            // Fechar a confirma√ß√£o
            fecharConfirmacao();
            
            // Mostrar mensagem de sucesso 
            mostrarAviso('sucesso', 'Documento gerado com sucesso!', function() {
                console.log("Callback do aviso executado - atualizando a interface");
                
                // AP√ìS clicar em OK no aviso, substitu√≠mos a interface completamente
                renderizarTelaDocumento(window.documentoGerado);
            });
            
            this.innerHTML = 'Confirmar';
            this.disabled = false;
        }, 2000);
    }

    // Configurar evento do bot√£o principal de confirmar
    document.getElementById('confirmar-btn').addEventListener('click', gerarDocumento);

    // Configurar evento do bot√£o preencher documento
    document.getElementById('preencher-btn').addEventListener('click', function() {
        document.getElementById('confirmacao-popup').style.display = 'flex';
    });

    // Adicionar fun√ß√£o para atualizar o iframe do documento
    function atualizarDocumentoIframe() {
        console.log("Fun√ß√£o de atualizar documento chamada");
        
        const iframe = document.getElementById('documento-iframe');
        if (iframe) {
            // Mostrar aviso de carregamento
            mostrarAviso('info', 'Atualizando documento, aguarde...');
            
            // Adicionar timestamp para for√ßar recarga sem cache
            const timestamp = new Date().getTime();
            const currentSrc = iframe.src;
            
            // Criar nova URL com timestamp
            const newSrc = currentSrc.includes('?') 
                ? `${currentSrc}&_ts=${timestamp}` 
                : `${currentSrc}?_ts=${timestamp}`;
            
            // Definir fun√ß√£o para quando o iframe terminar de carregar
            iframe.onload = function() {
                mostrarAviso('sucesso', 'Documento atualizado com sucesso!');
            };
            
            // Recarregar o iframe
            iframe.src = newSrc;
        } else {
            mostrarAviso('erro', 'N√£o foi poss√≠vel atualizar o documento.');
        }
    }

    // Adicionar um bot√£o de atualizar documento logo ap√≥s a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM carregado, procurando por bot√µes para adicionar o bot√£o de atualiza√ß√£o");
        
        // Verificar periodicamente se os bot√µes existem (para quando forem adicionados dinamicamente)
        const checkInterval = setInterval(function() {
            const btnAbrirDocumento = document.getElementById('btn-abrir-documento');
            const btnVoltar = document.getElementById('btn-voltar');
            
            // Se o bot√£o "Abrir em Nova Aba" existir e o bot√£o "Atualizar" n√£o existir ainda
            if (btnAbrirDocumento && btnVoltar && !document.getElementById('btn-atualizar-documento')) {
                console.log("Bot√µes encontrados, adicionando bot√£o de atualiza√ß√£o");
                
                // Criar o bot√£o de atualiza√ß√£o
                const btnAtualizar = document.createElement('button');
                btnAtualizar.id = 'btn-atualizar-documento';
                btnAtualizar.className = 'btn btn-warning';
                btnAtualizar.style.backgroundColor = '#ff9800';
                btnAtualizar.style.color = 'white';
                btnAtualizar.style.margin = '10px 0';
                btnAtualizar.textContent = 'Atualizar Arquivo';
                
                // Adicionar evento ao bot√£o
                btnAtualizar.addEventListener('click', atualizarDocumentoIframe);
                
                // Inserir o bot√£o ap√≥s o bot√£o "Abrir em Nova Aba"
                btnAbrirDocumento.parentNode.insertBefore(btnAtualizar, btnVoltar);
                
                // Limpar o intervalo ap√≥s adicionar o bot√£o
                clearInterval(checkInterval);
            }
        }, 500); // Verificar a cada 500ms
    });

    // Adicione esta fun√ß√£o para atualizar o documento
    function atualizarDocumento() {
        console.log('Atualizando documento...');
        const iframe = document.getElementById('documento-iframe');
        if (iframe) {
            // Adicionar timestamp para for√ßar recarga
            const timestamp = new Date().getTime();
            let novaSrc = iframe.src;
            
            // Remover qualquer timestamp anterior
            if (novaSrc.includes('_ts=')) {
                novaSrc = novaSrc.replace(/[&?]_ts=\d+/, '');
            }
            
            // Adicionar novo timestamp
            novaSrc = novaSrc.includes('?') ? 
                novaSrc + '&_ts=' + timestamp : 
                novaSrc + '?_ts=' + timestamp;
            
            // Recarregar iframe
            iframe.src = novaSrc;
            
            // Mostrar mensagem
            mostrarAviso('info', 'Atualizando documento...', function() {
                mostrarAviso('sucesso', 'Documento atualizado com sucesso!');
            });
        } else {
            mostrarAviso('erro', 'N√£o foi poss√≠vel encontrar o documento para atualizar.');
        }
    }

    // Habilitar modo de depura√ß√£o
    console.log('Depura√ß√£o ativada.');

    // MODIFICAR OS BOT√ïES DIRETAMENTE NA P√ÅGINA
    // Esta fun√ß√£o ser√° executada quando a p√°gina carregar e ap√≥s qualquer altera√ß√£o no DOM
    function adicionarBotaoAtualizar() {
        console.log('Verificando bot√µes existentes...');
        
        // Buscar pelo bot√£o "Abrir em Nova Aba"
        const botoesExistentes = document.querySelectorAll('.btn');
        
        if (botoesExistentes.length > 0) {
            console.log('Bot√µes encontrados:', botoesExistentes.length);
            
            // Verificar se j√° existe um bot√£o de atualizar
            if (!document.querySelector('.btn-atualizar-doc')) {
                console.log('Criando bot√£o de atualizar...');
                
                // Criar novo bot√£o
                const botaoAtualizar = document.createElement('button');
                botaoAtualizar.innerHTML = 'Atualizar Arquivo';
                botaoAtualizar.className = 'btn btn-warning btn-atualizar-doc';
                botaoAtualizar.style.marginRight = '5px';
                botaoAtualizar.style.backgroundColor = '#ff9800';
                botaoAtualizar.style.color = 'white';
                botaoAtualizar.onclick = atualizarDocumento;
                
                // Procurar o bot√£o "Voltar"
                let botaoVoltar = null;
                for (let i = 0; i < botoesExistentes.length; i++) {
                    if (botoesExistentes[i].innerText.includes('Voltar') || 
                        botoesExistentes[i].innerText.includes('voltar')) {
                        botaoVoltar = botoesExistentes[i];
                        break;
                    }
                }
                
                // Se encontrou o bot√£o voltar, inserir antes dele
                if (botaoVoltar) {
                    console.log('Inserindo bot√£o antes de "Voltar"');
                    botaoVoltar.parentNode.insertBefore(botaoAtualizar, botaoVoltar);
                } 
                // Caso contr√°rio, tentar encontrar o bot√£o de abrir em nova aba
                else {
                    let botaoAbrir = null;
                    for (let i = 0; i < botoesExistentes.length; i++) {
                        if (botoesExistentes[i].innerText.includes('Abrir') || 
                            botoesExistentes[i].innerText.includes('Nova Aba')) {
                            botaoAbrir = botoesExistentes[i];
                            break;
                        }
                    }
                    
                    // Se encontrou o bot√£o abrir, inserir depois dele
                    if (botaoAbrir) {
                        console.log('Inserindo bot√£o depois de "Abrir em Nova Aba"');
                        if (botaoAbrir.nextSibling) {
                            botaoAbrir.parentNode.insertBefore(botaoAtualizar, botaoAbrir.nextSibling);
                        } else {
                            botaoAbrir.parentNode.appendChild(botaoAtualizar);
                        }
                    } 
                    // Se n√£o encontrou nenhum bot√£o de refer√™ncia, adicionar diretamente na p√°gina
                    else {
                        console.log('Inserindo bot√£o diretamente na p√°gina');
                        const telaDocumento = document.getElementById('documento-container') || 
                                            document.querySelector('.container.mt-5');
                        
                        if (telaDocumento) {
                            // Criar container para o bot√£o se n√£o existir
                            let botoesContainer = telaDocumento.querySelector('.btn-group') || 
                                                telaDocumento.querySelector('.d-grid');
                            
                            if (!botoesContainer) {
                                console.log('Criando container para bot√µes');
                                botoesContainer = document.createElement('div');
                                botoesContainer.className = 'd-grid gap-2';
                                botoesContainer.style.marginTop = '15px';
                                telaDocumento.appendChild(botoesContainer);
                            }
                            
                            botoesContainer.appendChild(botaoAtualizar);
                        } else {
                            // √öltimo recurso: adicionar diretamente na p√°gina
                            console.log('√öltimo recurso: adicionar no body');
                            
                            // Criar um container flutuante para o bot√£o
                            const floatingBtn = document.createElement('div');
                            floatingBtn.style.position = 'fixed';
                            floatingBtn.style.bottom = '20px';
                            floatingBtn.style.right = '20px';
                            floatingBtn.style.zIndex = '9999';
                            
                            floatingBtn.appendChild(botaoAtualizar);
                            document.body.appendChild(floatingBtn);
                        }
                    }
                }
                
                console.log('Bot√£o "Atualizar Arquivo" adicionado com sucesso!');
            } else {
                console.log('Bot√£o de atualizar j√° existe.');
            }
        } else {
            console.log('Nenhum bot√£o encontrado ainda.');
        }
    }

    // Executar a fun√ß√£o quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM carregado, verificando bot√µes...');
        adicionarBotaoAtualizar();
        
        // Observar mudan√ßas no DOM para adicionar o bot√£o quando necess√°rio
        const observer = new MutationObserver(function(mutations) {
            adicionarBotaoAtualizar();
        });
        
        observer.observe(document.body, { 
            childList: true, 
            subtree: true 
        });
        
        // Verificar periodicamente tamb√©m
        setInterval(adicionarBotaoAtualizar, 1000);
        
        // Adicionar bot√£o direto entre "Abrir em Nova Aba" e "Voltar"
        setTimeout(function() {
            console.log('Tentativa direta de adicionar bot√£o ap√≥s 3 segundos');
            
            // Bot√£o Abrir em Nova Aba
            const btnAbrirNovaAba = document.querySelector('a[href="Abrir em Nova Aba"], button:contains("Abrir em Nova Aba")');
            
            if (btnAbrirNovaAba) {
                // Criar bot√£o Atualizar
                const btnAtualizar = document.createElement('button');
                btnAtualizar.className = 'btn btn-warning btn-atualizar-doc';
                btnAtualizar.innerHTML = 'Atualizar Arquivo';
                btnAtualizar.style.backgroundColor = '#ff9800';
                btnAtualizar.style.color = 'white';
                btnAtualizar.style.margin = '0 5px';
                btnAtualizar.onclick = atualizarDocumento;
                
                // Inserir ap√≥s bot√£o abrir
                btnAbrirNovaAba.parentNode.insertBefore(btnAtualizar, btnAbrirNovaAba.nextSibling);
                console.log('Bot√£o adicionado diretamente ap√≥s Abrir em Nova Aba');
            } else {
                console.log('Bot√£o Abrir em Nova Aba n√£o encontrado para m√©todo direto');
                
                // Se o bot√£o normal n√£o for encontrado, procurar pelo seletor visual
                const abrirBtn = document.querySelector('a.btn-primary, button.btn-primary');
                const voltarBtn = document.querySelector('a.btn-secondary, button.btn-secondary');
                
                if (abrirBtn && voltarBtn) {
                    const btnAtualizar = document.createElement('button');
                    btnAtualizar.className = 'btn btn-warning btn-atualizar-doc';
                    btnAtualizar.innerHTML = 'Atualizar Arquivo';
                    btnAtualizar.style.backgroundColor = '#ff9800';
                    btnAtualizar.style.color = 'white';
                    btnAtualizar.style.margin = '0 5px';
                    btnAtualizar.onclick = atualizarDocumento;
                    
                    voltarBtn.parentNode.insertBefore(btnAtualizar, voltarBtn);
                    console.log('Bot√£o adicionado entre os bot√µes baseado em classes');
                }
            }
        }, 3000);
    });

    // Inserir o bot√£o diretamente como um elemento fixo na p√°gina
    setTimeout(function() {
        console.log('Adicionando bot√£o fixo como √∫ltimo recurso');
        
        if (!document.querySelector('.btn-atualizar-doc')) {
            const fixedButton = document.createElement('button');
            fixedButton.innerHTML = 'ATUALIZAR ARQUIVO';
            fixedButton.className = 'btn btn-warning btn-atualizar-doc';
            fixedButton.style.position = 'fixed';
            fixedButton.style.bottom = '20px';
            fixedButton.style.right = '20px';
            fixedButton.style.zIndex = '9999';
            fixedButton.style.padding = '10px 20px';
            fixedButton.style.backgroundColor = '#ff9800';
            fixedButton.style.color = 'white';
            fixedButton.style.fontWeight = 'bold';
            fixedButton.style.border = 'none';
            fixedButton.style.borderRadius = '5px';
            fixedButton.style.boxShadow = '0 2px 5px rgba(0,0,0,0.3)';
            fixedButton.onclick = atualizarDocumento;
            
            document.body.appendChild(fixedButton);
            console.log('Bot√£o fixo adicionado');
        }
    }, 5000);

    // Fun√ß√£o para atualizar o documento (recarregar o iframe)
    function atualizarDocumento() {
      console.log("Fun√ß√£o atualizarDocumento chamada");
      
      // Tenta encontrar o iframe por v√°rios seletores poss√≠veis
      const iframe = document.getElementById('documento-iframe') || 
                    document.getElementById('documentoIframe') || 
                    document.querySelector('iframe');
      
      if (iframe) {
        // Mostrar um aviso de carregamento
        if (typeof mostrarAviso === 'function') {
          mostrarAviso('info', 'Atualizando documento, aguarde...');
        } else {
          alert('Atualizando documento...');
        }
        
        // Adiciona um timestamp para for√ßar recarregamento
        let currentSrc = iframe.src;
        
        // Remover timestamp anterior se existir
        if (currentSrc.includes('t=')) {
          currentSrc = currentSrc.replace(/[&?]t=\d+/, '');
        }
        
        // Adicionar novo timestamp
        const timestamp = new Date().getTime();
        const newSrc = currentSrc.includes('?') ? 
            `${currentSrc}&t=${timestamp}` : 
            `${currentSrc}?t=${timestamp}`;
        
        console.log("Atualizando iframe de:", currentSrc);
        console.log("Para:", newSrc);
        
        // Fun√ß√£o para quando o iframe terminar de carregar
        iframe.onload = function() {
          console.log("Iframe recarregado com sucesso");
          if (typeof mostrarAviso === 'function') {
            mostrarAviso('sucesso', 'Documento atualizado com sucesso!');
          }
        };
        
        // Atualizar o iframe
        iframe.src = newSrc;
      } else {
        console.error("Iframe n√£o encontrado");
        if (typeof mostrarAviso === 'function') {
          mostrarAviso('erro', 'N√£o foi poss√≠vel encontrar o documento para atualizar');
        } else {
          alert('Erro: N√£o foi poss√≠vel encontrar o documento para atualizar');
        }
      }
    }

    // Criar e adicionar o bot√£o fixo
    function criarBotaoFixoAtualizar() {
      // Remover bot√£o anterior se existir
      const botaoExistente = document.querySelector('.botao-fixo-atualizar');
      if (botaoExistente) {
        botaoExistente.remove();
      }

      // Criar novo bot√£o
      const botaoAtualizar = document.createElement('button');
      botaoAtualizar.className = 'botao-fixo-atualizar';
      botaoAtualizar.innerText = 'Atualizar Documento';
      botaoAtualizar.onclick = atualizarDocumento;
      
      // Adicionar √† p√°gina
      document.body.appendChild(botaoAtualizar);
      console.log("Bot√£o fixo de atualiza√ß√£o adicionado");
    }

    // Verificar periodicamente se o documento est√° sendo exibido
    setInterval(() => {
      const iframe = document.querySelector('iframe');
      const telaDocumento = document.getElementById('documento');
      if (iframe && telaDocumento && window.getComputedStyle(telaDocumento).display !== 'none') {
        criarBotaoFixoAtualizar();
      }
    }, 1000);

    // Criar o bot√£o imediatamente ao carregar a p√°gina
    document.addEventListener('DOMContentLoaded', () => {
      criarBotaoFixoAtualizar();
      console.log("Evento DOMContentLoaded: tentativa de criar bot√£o");
    });

    // Criar o bot√£o ap√≥s qualquer modifica√ß√£o no DOM
    const observer = new MutationObserver(() => {
      criarBotaoFixoAtualizar();
      console.log("MutationObserver: tentativa de criar bot√£o");
    });
    
    observer.observe(document.body, { 
      childList: true, 
      subtree: true 
    });
  </script>
  
  <!-- Script para adicionar o bot√£o de atualiza√ß√£o de documentos -->
  <script>
    // Auto-execu√ß√£o imediata para garantir aplica√ß√£o
    (function() {
        console.log("Script de atualiza√ß√£o de documentos iniciado");
        
        // Fun√ß√£o para adicionar o bot√£o de atualizar entre Abrir em Nova Aba e Voltar
        function adicionarBotaoAtualizar() {
            // Se o bot√£o j√° existe, n√£o adicionar novamente
            if (document.getElementById('btn-atualizar-arquivo')) {
                return;
            }
            
            console.log("Tentando adicionar bot√£o de atualiza√ß√£o");
            
            // Localizar os bot√µes existentes
            const btnAbrir = document.querySelector('a.btn-primary, button.btn-primary');
            const btnVoltar = document.querySelector('a.btn-secondary, button.btn-secondary');
            
            // Se encontrou os bot√µes e est√£o na mesma div
            if (btnAbrir && btnVoltar && btnAbrir.parentNode === btnVoltar.parentNode) {
                // Criar o bot√£o de atualizar
                const btnAtualizar = document.createElement('button');
                btnAtualizar.id = 'btn-atualizar-arquivo';
                btnAtualizar.className = 'btn btn-warning';
                btnAtualizar.style.backgroundColor = '#ff9800';
                btnAtualizar.style.color = 'white';
                btnAtualizar.style.fontWeight = 'bold';
                btnAtualizar.style.margin = '0 8px';
                btnAtualizar.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Arquivo';
                
                // Adicionar o bot√£o entre Abrir em Nova Aba e Voltar
                btnVoltar.parentNode.insertBefore(btnAtualizar, btnVoltar);
                console.log("Bot√£o de atualiza√ß√£o adicionado com sucesso");
                
                // Adicionar funcionalidade ao bot√£o
                btnAtualizar.addEventListener('click', atualizarDocumento);
            } else {
                console.log("N√£o foi poss√≠vel localizar os bot√µes necess√°rios");
            }
        }
        
        // Fun√ß√£o para atualizar o documento
        function atualizarDocumento() {
            console.log("Fun√ß√£o atualizarDocumento chamada");
            
            // Ajustar apar√™ncia do bot√£o durante a atualiza√ß√£o
            this.disabled = true;
            const textoOriginal = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
            
            // Procurar o iframe do documento
            const iframe = document.querySelector('iframe');
            if (iframe) {
                // Fun√ß√£o para executar quando o iframe terminar de carregar
                iframe.onload = () => {
                    setTimeout(() => {
                        this.disabled = false;
                        this.innerHTML = textoOriginal;
                        
                        // Mostrar mensagem de sucesso
                        if (typeof mostrarAviso === 'function') {
                            mostrarAviso('Sucesso', 'Documento atualizado com sucesso!');
                        } else {
                            alert('Documento atualizado com sucesso!');
                        }
                    }, 500);
                };
                
                // Adicionar timestamp para for√ßar recarregamento
                let currentSrc = iframe.src;
                
                // Remover timestamp anterior se existir
                if (currentSrc.includes('t=')) {
                    currentSrc = currentSrc.replace(/[&?]t=\d+/, '');
                }
                
                // Adicionar novo timestamp
                const timestamp = new Date().getTime();
                const newSrc = currentSrc.includes('?') ? 
                    `${currentSrc}&t=${timestamp}` : 
                    `${currentSrc}?t=${timestamp}`;
                
                console.log("Atualizando iframe para:", newSrc);
                iframe.src = newSrc;
            } else {
                // Restaurar bot√£o se n√£o encontrar o iframe
                this.disabled = false;
                this.innerHTML = textoOriginal;
                
                // Mostrar mensagem de erro
                if (typeof mostrarAviso === 'function') {
                    mostrarAviso('Erro', 'N√£o foi poss√≠vel encontrar o documento para atualizar');
                } else {
                    alert('Erro: N√£o foi poss√≠vel encontrar o documento para atualizar');
                }
            }
        }
        
        // Verificar se a tela do documento est√° vis√≠vel e adicionar o bot√£o
        function verificarTelaDocumento() {
            // Verificar a presen√ßa de elementos espec√≠ficos da tela de documento
            const iframe = document.querySelector('iframe');
            if (!iframe) return;
            
            // Verificar se estamos na tela de documento
            // Verificar bot√µes ou texto na p√°gina
            const documentoVisivel = 
                document.querySelector('.btn-primary') || 
                document.getElementById('btn-abrir-documento') ||
                document.querySelector('button:contains("Abrir em Nova Aba")') ||
                // Nova verifica√ß√£o espec√≠fica para a tela mostrada na imagem
                document.querySelector('h2:contains("Documento Gerado")') ||
                document.querySelector('div:contains("Documento gerado com sucesso")');
            
            if (documentoVisivel) {
                adicionarBotaoAtualizar();
            }
        }
        
        // Executar verifica√ß√£o quando o DOM estiver carregado
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', verificarTelaDocumento);
        } else {
            verificarTelaDocumento();
        }
        
        // Observar mudan√ßas no DOM para adicionar o bot√£o quando a tela mudar
        const observer = new MutationObserver(verificarTelaDocumento);
        observer.observe(document.body, { childList: true, subtree: true });
        
        // Verificar periodicamente (como garantia)
        setInterval(verificarTelaDocumento, 1000);
        
        // For√ßar execu√ß√£o ap√≥s 2 segundos para garantir que o DOM est√° completamente carregado
        setTimeout(verificarTelaDocumento, 2000);
    })();
  </script>

  <!-- Script para adicionar bot√£o de atualiza√ß√£o na tela de documento -->
  <script>
    // Executar quando o DOM estiver totalmente carregado
    document.addEventListener('DOMContentLoaded', function() {
      // Fun√ß√£o para adicionar o bot√£o de atualizar
      function adicionarBotaoAtualizar() {
        // Verificar se estamos na tela de documento
        const tituloPagina = document.querySelector('h2');
        if (!tituloPagina || tituloPagina.textContent !== 'Documento Gerado') return;
        
        // Verificar se o bot√£o j√° existe
        if (document.getElementById('btn-atualizar-doc')) return;
        
        // Encontrar o cont√™iner dos bot√µes
        const botaoVoltar = document.querySelector('button.btn-secondary, .btn.btn-secondary, button:contains("Voltar")');
        const botaoAbrir = document.querySelector('button.btn-primary, .btn.btn-primary, button:contains("Abrir em Nova Aba")');
        
        if (!botaoVoltar || !botaoAbrir) return;
        
        // Criar o bot√£o de atualiza√ß√£o
        const botaoAtualizar = document.createElement('button');
        botaoAtualizar.id = 'btn-atualizar-doc';
        botaoAtualizar.className = 'btn btn-warning';
        botaoAtualizar.innerText = 'Atualizar Documento';
        botaoAtualizar.style.backgroundColor = '#ff9800';
        botaoAtualizar.style.color = 'white';
        botaoAtualizar.style.fontWeight = 'bold';
        botaoAtualizar.style.marginLeft = '10px';
        botaoAtualizar.style.marginRight = '10px';
        
        // Adicionar o bot√£o antes do bot√£o Voltar
        botaoVoltar.parentNode.insertBefore(botaoAtualizar, botaoVoltar);
        
        // Adicionar funcionalidade ao bot√£o
        botaoAtualizar.addEventListener('click', function() {
          // Mostrar indicador de carregamento no bot√£o
          this.disabled = true;
          const textoOriginal = this.innerText;
          this.innerText = 'Atualizando...';
          
          // Encontrar o iframe do documento
          const iframe = document.querySelector('iframe');
          if (iframe) {
            // Configurar a√ß√£o para quando o iframe terminar de carregar
            iframe.onload = () => {
              setTimeout(() => {
                botaoAtualizar.disabled = false;
                botaoAtualizar.innerText = textoOriginal;
                
                // Mostrar mensagem de sucesso
                if (typeof mostrarAviso === 'function') {
                  mostrarAviso('Sucesso', 'Documento atualizado com sucesso!', 'success');
                } else {
                  alert('Documento atualizado com sucesso!');
                }
              }, 500);
            };
            
            // Atualizar o iframe adicionando timestamp para for√ßar recarregamento
            let src = iframe.src;
            if (src.includes('t=')) {
              src = src.replace(/[&?]t=\d+/, '');
            }
            
            const timestamp = new Date().getTime();
            iframe.src = src.includes('?') ? `${src}&t=${timestamp}` : `${src}?t=${timestamp}`;
          } else {
            // Se n√£o encontrar o iframe, restaurar o bot√£o
            this.disabled = false;
            this.innerText = textoOriginal;
            
            // Mostrar mensagem de erro
            if (typeof mostrarAviso === 'function') {
              mostrarAviso('Erro', 'N√£o foi poss√≠vel encontrar o documento para atualizar', 'error');
            } else {
              alert('Erro: N√£o foi poss√≠vel encontrar o documento para atualizar');
            }
          }
        });
      }
      
      // Executar imediatamente
      adicionarBotaoAtualizar();
      
      // Executar periodicamente para garantir que o bot√£o seja adicionado ap√≥s navega√ß√£o
      setInterval(adicionarBotaoAtualizar, 1000);
      
      // Observar mudan√ßas no DOM para detectar quando a tela de documento √© carregada
      const observer = new MutationObserver(function() {
        adicionarBotaoAtualizar();
      });
      
      observer.observe(document.body, { childList: true, subtree: true });
    });
  </script>

  <!-- Script espec√≠fico para adicionar bot√£o de atualiza√ß√£o na tela -->
  <script>
    // Executar assim que o documento estiver dispon√≠vel
    document.addEventListener('DOMContentLoaded', function() {
      // Adicionar estilos para notifica√ß√µes mais leves
      const toastStyle = document.createElement('style');
      toastStyle.id = 'toast-notificacao-style';
      toastStyle.textContent = `
        .toast-notificacao {
          position: fixed;
          top: 20px;
          right: 20px;
          background-color: #4caf50;
          color: white;
          padding: 12px 20px;
          border-radius: 4px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.2);
          z-index: 9999;
          font-weight: bold;
          display: flex;
          align-items: center;
          animation: toastFadeIn 0.3s ease;
        }
        .toast-notificacao.erro {
          background-color: #f44336;
        }
        .toast-notificacao i {
          margin-right: 10px;
          font-size: 20px;
        }
        @keyframes toastFadeIn {
          from { opacity: 0; transform: translateY(-20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes toastFadeOut {
          from { opacity: 1; transform: translateY(0); }
          to { opacity: 0; transform: translateY(-20px); }
        }
      `;
      document.head.appendChild(toastStyle);
      
      // Fun√ß√£o para mostrar notifica√ß√£o leve tipo toast
      window.mostrarToast = function(mensagem, tipo = 'sucesso') {
        // Remover qualquer toast existente
        const toastExistente = document.querySelector('.toast-notificacao');
        if (toastExistente) {
          document.body.removeChild(toastExistente);
        }
        
        // Criar novo toast
        const toast = document.createElement('div');
        toast.className = `toast-notificacao ${tipo === 'erro' ? 'erro' : ''}`;
        toast.innerHTML = `<i class="fas fa-${tipo === 'erro' ? 'exclamation-circle' : 'check-circle'}"></i> ${mensagem}`;
        
        document.body.appendChild(toast);
        
        // Remover ap√≥s 3 segundos
        setTimeout(() => {
          if (toast.parentNode) {
            toast.style.animation = 'toastFadeOut 0.3s ease forwards';
            setTimeout(() => {
              if (toast.parentNode) {
                document.body.removeChild(toast);
              }
            }, 300);
          }
        }, 3000);
      };
      
      // Fun√ß√£o para adicionar o bot√£o
      function adicionarBotaoAtualizar() {
        // Verificar se existem bot√µes na tela
        const botoes = document.querySelectorAll('button');
        let botaoAssinatura = null;
        
        for (const botao of botoes) {
          if (botao.textContent.includes('Gerar Assinatura Digital')) {
            botaoAssinatura = botao;
            break;
          }
        }
        
        // Se encontrou o bot√£o de assinatura e o bot√£o j√° n√£o existe
        if (botaoAssinatura && !document.getElementById('botao-atualizar-doc')) {
          // Criar o bot√£o de atualizar
          const botaoAtualizar = document.createElement('button');
          botaoAtualizar.id = 'botao-atualizar-doc';
          botaoAtualizar.className = botaoAssinatura.className.replace('btn-success', 'btn-warning');
          botaoAtualizar.style.backgroundColor = '#ff9800';
          botaoAtualizar.style.color = 'white';
          botaoAtualizar.style.fontWeight = 'bold';
          botaoAtualizar.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Documento';
          
          // Criar o bot√£o de impress√£o
          const botaoImprimir = document.createElement('button');
          botaoImprimir.id = 'botao-imprimir-doc';
          botaoImprimir.className = botaoAssinatura.className.replace('btn-success', 'btn-info');
          botaoImprimir.style.backgroundColor = '#2196F3';
          botaoImprimir.style.color = 'white';
          botaoImprimir.style.fontWeight = 'bold';
          botaoImprimir.style.marginLeft = '15px'; // Adicionar margem √† esquerda
          botaoImprimir.innerHTML = '<i class="fas fa-print"></i> Imprimir Documento';
          
          // Inserir ap√≥s o bot√£o de assinatura digital
          botaoAssinatura.insertAdjacentElement('afterend', botaoAtualizar);
          botaoAtualizar.insertAdjacentElement('afterend', botaoImprimir);
          
          // Adicionar funcionalidade otimizada ao bot√£o de atualizar
          botaoAtualizar.addEventListener('click', function() {
            // Indicador visual de carregamento
            this.disabled = true;
            const textoOriginal = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
            
            // Encontrar o iframe do documento
            const iframe = document.querySelector('iframe');
            if (iframe) {
              // PRIMEIRO: Atualizar o iframe imediatamente para maior velocidade
              let src = iframe.src;
              if (src.includes('t=')) {
                src = src.replace(/[&?]t=\d+/, '');
              }
              
              // Adicionar timestamp √∫nico para for√ßar recarga
              const timestamp = new Date().getTime();
              const newSrc = src.includes('?') ? 
                `${src}&t=${timestamp}` : 
                `${src}?t=${timestamp}`;
              
              // Configurar evento onload antes de mudar o src
              iframe.onload = () => {
                // Restaurar estado do bot√£o
                setTimeout(() => {
                  botaoAtualizar.disabled = false;
                  botaoAtualizar.innerHTML = textoOriginal;
                  // Mostrar notifica√ß√£o leve
                  window.mostrarToast('Documento atualizado com sucesso!');
                }, 300);
              };
              
              // Atualizar o src ap√≥s configurar o evento onload
              iframe.src = newSrc;
            } else {
              // Restaurar o bot√£o em caso de erro
              setTimeout(() => {
                this.disabled = false;
                this.innerHTML = textoOriginal;
                window.mostrarToast('N√£o foi poss√≠vel encontrar o documento', 'erro');
              }, 300);
            }
          });
          
          // Adicionar funcionalidade ao bot√£o de impress√£o
          botaoImprimir.addEventListener('click', function() {
            // Indicador visual de carregamento
            this.disabled = true;
            const textoOriginal = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Preparando...';
            
            // Encontrar o iframe do documento
            const iframe = document.querySelector('iframe');
            if (iframe) {
              try {
                // Criar uma nova janela para impress√£o
                const printWindow = window.open('', '_blank');
                if (printWindow) {
                  // Criar conte√∫do tempor√°rio para impress√£o
                  printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                      <title>Impress√£o de Documento</title>
                      <style>
                        body { margin: 0; padding: 0; }
                        iframe { width: 100%; height: 100vh; border: none; }
                        @media print {
                          body { margin: 0; padding: 0; }
                          iframe { height: auto; min-height: 100vh; }
                        }
                      </style>
                    </head>
                    <body>
                      <iframe src="${iframe.src}" onload="setTimeout(function() { window.print(); }, 1000);"></iframe>
                    </body>
                    </html>
                  `);
                  printWindow.document.close();
                  
                  // Instruir o usu√°rio ap√≥s abrir a janela
                  window.mostrarToast('Documento aberto para impress√£o. Use as op√ß√µes do navegador para imprimir');
                } else {
                  // Se o navegador bloqueou o popup
                  window.mostrarToast('Seu navegador bloqueou o popup de impress√£o. Por favor, permita popups para este site.', 'erro');
                }
              } catch (error) {
                console.error('Erro ao tentar imprimir:', error);
                window.mostrarToast('N√£o foi poss√≠vel imprimir. Tente usar a op√ß√£o "Abrir em Nova Aba" e depois imprimir do navegador.', 'erro');
              }
                
              // Restaurar o bot√£o
              setTimeout(() => {
                this.disabled = false;
                this.innerHTML = textoOriginal;
              }, 1000);
            } else {
              // Restaurar o bot√£o
              this.disabled = false;
              this.innerHTML = textoOriginal;
              window.mostrarToast('N√£o foi poss√≠vel encontrar o documento para imprimir', 'erro');
            }
          });
        }
      }
      
      // Tentar adicionar o bot√£o imediatamente
      adicionarBotaoAtualizar();
      
      // Continuar tentando adicionar em intervalos de tempo
      setInterval(adicionarBotaoAtualizar, 1000);
      
      // Tamb√©m observar mudan√ßas no DOM
      const observer = new MutationObserver(adicionarBotaoAtualizar);
      observer.observe(document.body, { childList: true, subtree: true });
    });
  </script>
</body>
</html>


